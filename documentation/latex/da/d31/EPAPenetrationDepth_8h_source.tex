\doxysection{EPAPenetration\+Depth.\+h}
\hypertarget{EPAPenetrationDepth_8h_source}{}\label{EPAPenetrationDepth_8h_source}\index{includes/jolt/Geometry/EPAPenetrationDepth.h@{includes/jolt/Geometry/EPAPenetrationDepth.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Jolt\ Physics\ Library\ (https://github.com/jrouwe/JoltPhysics)}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ SPDX-\/FileCopyrightText:\ 2021\ Jorrit\ Rouwe}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ SPDX-\/License-\/Identifier:\ MIT}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <Jolt/Core/StaticArray.h>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <Jolt/Core/Profiler.h>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <Jolt/Geometry/GJKClosestPoint.h>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <Jolt/Geometry/EPAConvexHullBuilder.h>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{comment}{//\#define\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ JPH\_NAMESPACE\_BEGIN}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classEPAPenetrationDepth}{EPAPenetrationDepth}}}
\DoxyCodeLine{00037\ \{}
\DoxyCodeLine{00038\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//\ Typedefs}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{int}\ cMaxPoints\ =\ \mbox{\hyperlink{classEPAConvexHullBuilder_a6968898ef16408b14c1000bebf2f2576}{EPAConvexHullBuilder::cMaxPoints}};}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{int}\ cMaxPointsToIncludeOriginInHull\ =\ 32;}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{static\_assert}(cMaxPointsToIncludeOriginInHull\ <\ cMaxPoints);}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle}{Triangle}}\ =\ \mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle}{EPAConvexHullBuilder::Triangle}};}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Points}{Points}}\ =\ \mbox{\hyperlink{classEPAConvexHullBuilder_1_1Points}{EPAConvexHullBuilder::Points}};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classGJKClosestPoint}{GJKClosestPoint}}\ \ \ \ \ \ mGJK;}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{class\ }SupportPoints}
\DoxyCodeLine{00052\ \ \ \ \ \{}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAConvexHullBuilder_1_1Points}{Points}}\ \ \ \ \ \ \ \ \ \ \ \ mY;}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ mP[cMaxPoints];}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ mQ[cMaxPoints];}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ A,\ \textcolor{keyword}{typename}\ B>}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ Add(\textcolor{keyword}{const}\ A\ \&inA,\ \textcolor{keyword}{const}\ B\ \&inB,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inDirection,\ \textcolor{keywordtype}{int}\ \&outIndex)}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ support\ point\ of\ the\ minkowski\ sum\ A\ -\/\ B}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ p\ =\ inA.GetSupport(inDirection);}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ q\ =\ inB.GetSupport(-\/inDirection);}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ w\ =\ p\ -\/\ q;}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Store\ new\ point}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ outIndex\ =\ mY.\mbox{\hyperlink{classStaticArray_aea449055e7dab910eca1a4af05d53b6f}{size}}();}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ mY.\mbox{\hyperlink{classStaticArray_a1117d7fa5ecfe22248396f1632d842cb}{push\_back}}(w);}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ mP[outIndex]\ =\ p;}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ mQ[outIndex]\ =\ q;}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ w;}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \ \ \};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{enum\ class}\ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0}{EStatus}}}
\DoxyCodeLine{00081\ \ \ \ \ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0a0497a652be066f6f966a97fa6c67c9c0}{NotColliding}},\ \ \ \ \ \ \ }
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0ae0f4d0dafbcf08dd28d80154056ad0d8}{Colliding}},\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0aa2d00c353d1f9a5f07852650030dbd53}{Indeterminate}}\ \ \ \ \ \ }
\DoxyCodeLine{00085\ \ \ \ \ \};}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ AE,\ \textcolor{keyword}{typename}\ BE>}
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0}{EStatus}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAPenetrationDepth_a903dc39955aae9b4e9eced5a396eb5a7}{GetPenetrationDepthStepGJK}}(\textcolor{keyword}{const}\ AE\ \&inAExcludingConvexRadius,\ \textcolor{keywordtype}{float}\ inConvexRadiusA,\ \textcolor{keyword}{const}\ BE\ \&inBExcludingConvexRadius,\ \textcolor{keywordtype}{float}\ inConvexRadiusB,\ \textcolor{keywordtype}{float}\ inTolerance,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&ioV,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outPointA,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outPointB)}
\DoxyCodeLine{00100\ \ \ \ \ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ JPH\_PROFILE\_FUNCTION();}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ supply\ a\ zero\ ioV,\ we\ only\ want\ to\ get\ points\ on\ the\ hull\ of\ the\ Minkowsky\ sum\ and\ not\ internal\ points}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ JPH\_ASSERT(!ioV.\mbox{\hyperlink{classVec3_acee93ea875b86bc0f63edebe2b592dbc}{IsNearZero}}());}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ closest\ points}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ combined\_radius\ =\ inConvexRadiusA\ +\ inConvexRadiusB;}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ combined\_radius\_sq\ =\ combined\_radius\ *\ combined\_radius;}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ closest\_points\_dist\_sq\ =\ mGJK.\mbox{\hyperlink{classGJKClosestPoint_abb7cfdd49d708007d75b4c2e9b90ebb9}{GetClosestPoints}}(inAExcludingConvexRadius,\ inBExcludingConvexRadius,\ inTolerance,\ combined\_radius\_sq,\ ioV,\ outPointA,\ outPointB);}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (closest\_points\_dist\_sq\ >\ combined\_radius\_sq)}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ collision}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0a0497a652be066f6f966a97fa6c67c9c0}{EStatus::NotColliding}};}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (closest\_points\_dist\_sq\ >\ 0.0f)}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Collision\ within\ convex\ radius,\ adjust\ points\ for\ convex\ radius}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ v\_len\ =\ sqrt(closest\_points\_dist\_sq);\ \textcolor{comment}{//\ GetClosestPoints\ function\ returns\ |ioV|\string^2\ when\ return\ value\ <\ FLT\_MAX}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ outPointA\ +=\ ioV\ *\ (inConvexRadiusA\ /\ v\_len);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ outPointB\ -\/=\ ioV\ *\ (inConvexRadiusB\ /\ v\_len);}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0ae0f4d0dafbcf08dd28d80154056ad0d8}{EStatus::Colliding}};}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0aa2d00c353d1f9a5f07852650030dbd53}{EStatus::Indeterminate}};}
\DoxyCodeLine{00125\ \ \ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ AI,\ \textcolor{keyword}{typename}\ BI>}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAPenetrationDepth_acff8a6121c0896e3aabbe3a18019f201}{GetPenetrationDepthStepEPA}}(\textcolor{keyword}{const}\ AI\ \&inAIncludingConvexRadius,\ \textcolor{keyword}{const}\ BI\ \&inBIncludingConvexRadius,\ \textcolor{keywordtype}{float}\ inTolerance,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outV,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outPointA,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outPointB)}
\DoxyCodeLine{00141\ \ \ \ \ \{}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ JPH\_PROFILE\_FUNCTION();}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ that\ the\ tolerance\ makes\ sense\ (smaller\ value\ than\ this\ will\ just\ result\ in\ needless\ iterations)}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ JPH\_ASSERT(inTolerance\ >=\ FLT\_EPSILON);}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fetch\ the\ simplex\ from\ GJK\ algorithm}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ SupportPoints\ support\_points;}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ mGJK.\mbox{\hyperlink{classGJKClosestPoint_a73d6f276fb275026a0126ca7361fb2bf}{GetClosestPointsSimplex}}(support\_points.mY.data(),\ support\_points.mP,\ support\_points.mQ,\ support\_points.mY.GetSizeRef());}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ up\ the\ amount\ of\ support\ points\ to\ 4}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (support\_points.mY.size())}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1\ vertex,\ which\ must\ be\ at\ the\ origin,\ which\ is\ useless\ for\ our\ purpose}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(support\_points.mY[0].IsNearZero(1.0e-\/8f));}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ support\_points.mY.pop\_back();}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ support\ points\ in\ 4\ directions\ to\ form\ a\ tetrahedron\ around\ the\ origin}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ p1,\ p2,\ p3,\ p4;}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (void)support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ \mbox{\hyperlink{classVec3}{Vec3}}(0,\ 1,\ 0),\ p1);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (void)support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ \mbox{\hyperlink{classVec3}{Vec3}}(-\/1,\ -\/1,\ -\/1),\ p2);}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (void)support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ \mbox{\hyperlink{classVec3}{Vec3}}(1,\ -\/1,\ -\/1),\ p3);}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (void)support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ \mbox{\hyperlink{classVec3}{Vec3}}(0,\ -\/1,\ 1),\ p4);}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(p1\ ==\ 0);}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(p2\ ==\ 1);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(p3\ ==\ 2);}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(p4\ ==\ 3);}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Two\ vertices,\ create\ 3\ extra\ by\ taking\ perpendicular\ axis\ and\ rotating\ it\ around\ in\ 120\ degree\ increments}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ axis\ =\ (support\_points.mY[1]\ -\/\ support\_points.mY[0]).Normalized();}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ rotation\ =\ \mbox{\hyperlink{classMat44_ac3109f2d950061c0b4de57e76a132634}{Mat44::sRotation}}(axis,\ DegreesToRadians(120.0f));}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ dir1\ =\ axis.\mbox{\hyperlink{classVec3_a24a96972fdbe04ae9a3e340fd4c39b81}{GetNormalizedPerpendicular}}();}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ dir2\ =\ rotation\ *\ dir1;}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ dir3\ =\ rotation\ *\ dir2;}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ p1,\ p2,\ p3;}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (void)support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ dir1,\ p1);}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (void)support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ dir2,\ p2);}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (void)support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ dir3,\ p3);}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(p1\ ==\ 2);}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(p2\ ==\ 3);}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(p3\ ==\ 4);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 3:}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 4:}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ already\ have\ enough\ points}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ hull\ out\ of\ the\ initial\ points}}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ JPH\_ASSERT(support\_points.mY.size()\ >=\ 3);}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAConvexHullBuilder}{EPAConvexHullBuilder}}\ hull(support\_points.mY);}
\DoxyCodeLine{00200\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_CONVEX\_BUILDER\_DRAW}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ hull.DrawLabel(\textcolor{stringliteral}{"{}Build\ initial\ hull"{}});}
\DoxyCodeLine{00202\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00203\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ Trace(\textcolor{stringliteral}{"{}Init:\ num\_points\ =\ \%u"{}},\ (uint)support\_points.mY.size());}
\DoxyCodeLine{00205\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_ac6b69723ed9d2c1b815769f9953ef8e7}{Initialize}}(0,\ 1,\ 2);}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{typename}\ Points::size\_type\ i\ =\ 3;\ i\ <\ support\_points.mY.size();\ ++i)}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ dist\_sq;}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle}{Triangle}}\ *t\ =\ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_aba8a5ac94c67e4c96e5eb533dfca3a83}{FindFacingTriangle}}(support\_points.mY[i],\ dist\_sq);}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classStaticArray}{EPAConvexHullBuilder::NewTriangles}}\ new\_triangles;}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!hull.\mbox{\hyperlink{classEPAConvexHullBuilder_ae1b6e6eb12d8723eeab4265f9510b7c2}{AddPoint}}(t,\ i,\ FLT\_MAX,\ new\_triangles))}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can't\ recover\ from\ a\ failure\ to\ add\ a\ point\ to\ the\ hull\ because\ the\ old\ triangles\ have\ been\ unlinked\ already.}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Assume\ no\ collision.\ This\ can\ happen\ if\ the\ shapes\ touch\ in\ 1\ point\ (or\ plane)\ in\ which\ case\ the\ hull\ is\ degenerate.}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_CONVEX\_BUILDER\_DRAW}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ hull.DrawLabel(\textcolor{stringliteral}{"{}Complete\ hull"{}});}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generate\ the\ hull\ of\ the\ Minkowski\ difference\ for\ visualization}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structMinkowskiDifference}{MinkowskiDifference}}\ diff(inAIncludingConvexRadius,\ inBIncludingConvexRadius);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRef}{DebugRenderer::GeometryRef}}\ geometry\ =\ \mbox{\hyperlink{classDebugRenderer_a8b92e7678965c488b8d68230816aa000}{DebugRenderer::sInstance}}-\/>CreateTriangleGeometryForConvex([\&diff](\mbox{\hyperlink{classVec3}{Vec3Arg}}\ inDirection)\ \{\ \textcolor{keywordflow}{return}\ diff.\mbox{\hyperlink{structMinkowskiDifference_ad9e15e934b19be1df6e09a926a1e26dd}{GetSupport}}(inDirection);\ \});}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ hull.DrawGeometry(geometry,\ Color::sYellow);}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ hull.DrawLabel(\textcolor{stringliteral}{"{}Ensure\ origin\ in\ hull"{}});}
\DoxyCodeLine{00232\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Loop\ until\ we\ are\ sure\ that\ the\ origin\ is\ inside\ the\ hull}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ next\ closest\ triangle}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle}{Triangle}}\ *t\ =\ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a0b52c132a7365cd272f3ca14a8f25145}{PeekClosestTriangleInQueue}}();}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ process\ removed\ triangles,\ just\ free\ them\ (because\ they're\ in\ a\ heap\ we\ don't\ remove\ them\ earlier\ since\ we\ would\ have\ to\ rebuild\ the\ sorted\ heap)}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_aec2b4eeafa28ea5ea8a04789e944ae4d}{mRemoved}})}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a7095af90fda9266b9ae7258025623499}{PopClosestTriangleFromQueue}}();}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ run\ out\ of\ triangles,\ we\ couldn't\ include\ the\ origin\ in\ the\ hull\ so\ there\ must\ be\ very\ little\ penetration\ and\ we\ report\ no\ collision.}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a233403c7274da823fb6b96b539dc5f95}{HasNextTriangle}}())}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a8a5be413b034888eeb3ccc384e1ca9ec}{FreeTriangle}}(t);}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ closest\ to\ the\ triangle\ is\ zero\ or\ positive,\ the\ origin\ is\ in\ the\ hull\ and\ we\ can\ proceed\ to\ the\ main\ algorithm}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a89216110b3cac04a274376acaf28d7ae}{mClosestLenSq}}\ >=\ 0.0f)}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_CONVEX\_BUILDER\_DRAW}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ hull.DrawLabel(\textcolor{stringliteral}{"{}Next\ iteration"{}});}
\DoxyCodeLine{00259\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00260\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ Trace(\textcolor{stringliteral}{"{}EncapsulateOrigin:\ verts\ =\ (\%d,\ \%d,\ \%d),\ closest\_dist\_sq\ =\ \%g,\ centroid\ =\ (\%g,\ \%g,\ \%g),\ normal\ =\ (\%g,\ \%g,\ \%g)"{}},}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[0].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}},\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[1].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}},\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[2].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}},}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a89216110b3cac04a274376acaf28d7ae}{mClosestLenSq}},}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}}.\mbox{\hyperlink{classVec3_a284e29f161ae7709a934f402bd2a848c}{GetX}}(),\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}}.GetY(),\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}}.GetZ(),}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.\mbox{\hyperlink{classVec3_a284e29f161ae7709a934f402bd2a848c}{GetX}}(),\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.GetY(),\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.GetZ());}
\DoxyCodeLine{00266\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ triangle\ from\ the\ queue\ before\ we\ start\ adding\ new\ ones\ (which\ may\ result\ in\ a\ new\ closest\ triangle\ at\ the\ front\ of\ the\ queue)}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a7095af90fda9266b9ae7258025623499}{PopClosestTriangleFromQueue}}();}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ a\ support\ point\ to\ get\ the\ origin\ inside\ the\ hull}}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ new\_index;}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ w\ =\ support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}},\ new\_index);}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_CONVEX\_BUILDER\_DRAW}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Draw\ the\ point\ that\ we're\ adding}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ hull.DrawMarker(w,\ Color::sRed,\ 1.0f);}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ hull.DrawWireTriangle(*t,\ Color::sRed);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ hull.DrawState();}
\DoxyCodeLine{00280\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ the\ point\ to\ the\ hull,\ if\ we\ fail\ we\ terminate\ and\ report\ no\ collision}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classStaticArray}{EPAConvexHullBuilder::NewTriangles}}\ new\_triangles;}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a60543dea65ee8e56fa77132610302412}{IsFacing}}(w)\ ||\ !hull.\mbox{\hyperlink{classEPAConvexHullBuilder_ae1b6e6eb12d8723eeab4265f9510b7c2}{AddPoint}}(t,\ new\_index,\ FLT\_MAX,\ new\_triangles))}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ triangle\ is\ facing\ the\ support\ point\ "{}w"{}\ and\ can\ now\ be\ safely\ removed}}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ JPH\_ASSERT(t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_aec2b4eeafa28ea5ea8a04789e944ae4d}{mRemoved}});}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a8a5be413b034888eeb3ccc384e1ca9ec}{FreeTriangle}}(t);}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ run\ out\ of\ triangles\ or\ points,\ we\ couldn't\ include\ the\ origin\ in\ the\ hull\ so\ there\ must\ be\ very\ little\ penetration\ and\ we\ report\ no\ collision.}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a233403c7274da823fb6b96b539dc5f95}{HasNextTriangle}}()\ ||\ support\_points.mY.size()\ >=\ cMaxPointsToIncludeOriginInHull)}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_CONVEX\_BUILDER\_DRAW}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ hull.DrawLabel(\textcolor{stringliteral}{"{}Main\ algorithm"{}});}
\DoxyCodeLine{00298\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Current\ closest\ distance\ to\ origin}}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ closest\_dist\_sq\ =\ FLT\_MAX;}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remember\ last\ good\ triangle}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle}{Triangle}}\ *last\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ want\ to\ flip\ the\ penetration\ depth}}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ flip\_v\_sign\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Loop\ until\ closest\ point\ found}}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ closest\ triangle\ to\ the\ origin}}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle}{Triangle}}\ *t\ =\ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a7095af90fda9266b9ae7258025623499}{PopClosestTriangleFromQueue}}();}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ process\ removed\ triangles,\ just\ free\ them\ (because\ they're\ in\ a\ heap\ we\ don't\ remove\ them\ earlier\ since\ we\ would\ have\ to\ rebuild\ the\ sorted\ heap)}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_aec2b4eeafa28ea5ea8a04789e944ae4d}{mRemoved}})}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a8a5be413b034888eeb3ccc384e1ca9ec}{FreeTriangle}}(t);}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_CONVEX\_BUILDER\_DRAW}}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ hull.DrawLabel(\textcolor{stringliteral}{"{}Next\ iteration"{}});}
\DoxyCodeLine{00324\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00325\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ Trace(\textcolor{stringliteral}{"{}FindClosest:\ verts\ =\ (\%d,\ \%d,\ \%d),\ closest\_len\_sq\ =\ \%g,\ centroid\ =\ (\%g,\ \%g,\ \%g),\ normal\ =\ (\%g,\ \%g,\ \%g)"{}},}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[0].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}},\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[1].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}},\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[2].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}},}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a89216110b3cac04a274376acaf28d7ae}{mClosestLenSq}},}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}}.\mbox{\hyperlink{classVec3_a284e29f161ae7709a934f402bd2a848c}{GetX}}(),\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}}.GetY(),\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}}.GetZ(),}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.\mbox{\hyperlink{classVec3_a284e29f161ae7709a934f402bd2a848c}{GetX}}(),\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.GetY(),\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.GetZ());}
\DoxyCodeLine{00331\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ next\ triangle\ is\ further\ away\ than\ closest\ point,\ we've\ found\ the\ closest\ point}}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a89216110b3cac04a274376acaf28d7ae}{mClosestLenSq}}\ >=\ closest\_dist\_sq)}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Replace\ last\ good\ with\ this\ triangle}}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (last\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a8a5be413b034888eeb3ccc384e1ca9ec}{FreeTriangle}}(last);}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ last\ =\ t;}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ support\ point\ in\ direction\ of\ normal\ of\ the\ plane}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note\ that\ the\ article\ uses\ the\ closest\ point\ between\ the\ origin\ and\ plane,\ but\ this\ always\ has\ the\ exact\ same\ direction\ as\ the\ normal\ (if\ the\ origin\ is\ behind\ the\ plane)}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ this\ way\ we\ do\ less\ calculations\ and\ lose\ less\ precision}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ new\_index;}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ w\ =\ support\_points.Add(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}},\ new\_index);}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Project\ w\ onto\ the\ triangle\ normal}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ dot\ =\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(w);}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ we\ just\ found\ a\ separating\ axis.\ This\ can\ happen\ if\ the\ shape\ shrunk\ by\ convex\ radius\ and\ then\ expanded\ by}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ convex\ radius\ is\ bigger\ then\ the\ original\ shape\ due\ to\ inaccuracies\ in\ the\ shrinking\ process.}}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dot\ <\ 0.0f)}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ distance\ squared\ (along\ normal)\ to\ the\ support\ point}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ dist\_sq\ =\ Square(dot)\ /\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.\mbox{\hyperlink{classVec3_aba501a6a474028084799f871c9083dc1}{LengthSq}}();}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ Trace(\textcolor{stringliteral}{"{}FindClosest:\ w\ =\ (\%g,\ \%g,\ \%g),\ dot\ =\ \%g,\ dist\_sq\ =\ \%g"{}},}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w.\mbox{\hyperlink{classVec3_a284e29f161ae7709a934f402bd2a848c}{GetX}}(),\ w.GetY(),\ w.GetZ(),}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dot,\ dist\_sq);}
\DoxyCodeLine{00362\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00363\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_CONVEX\_BUILDER\_DRAW}}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Draw\ the\ point\ that\ we're\ adding}}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ hull.DrawMarker(w,\ Color::sPurple,\ 1.0f);}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ hull.DrawWireTriangle(*t,\ Color::sPurple);}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ hull.DrawState();}
\DoxyCodeLine{00368\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ error\ became\ small\ enough,\ we've\ converged}}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist\_sq\ -\/\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a89216110b3cac04a274376acaf28d7ae}{mClosestLenSq}}\ <\ t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a89216110b3cac04a274376acaf28d7ae}{mClosestLenSq}}\ *\ inTolerance)}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00373\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Trace(\textcolor{stringliteral}{"{}Converged"{}});}
\DoxyCodeLine{00375\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Keep\ track\ of\ the\ minimum\ distance}}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ closest\_dist\_sq\ =\ min(closest\_dist\_sq,\ dist\_sq);}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ triangle\ thinks\ this\ point\ is\ not\ front\ facing,\ we've\ reached\ numerical\ precision\ and\ we're\ done}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a60543dea65ee8e56fa77132610302412}{IsFacing}}(w))}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00385\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Trace(\textcolor{stringliteral}{"{}Not\ facing\ triangle"{}});}
\DoxyCodeLine{00387\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ point\ to\ hull}}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classStaticArray}{EPAConvexHullBuilder::NewTriangles}}\ new\_triangles;}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!hull.\mbox{\hyperlink{classEPAConvexHullBuilder_ae1b6e6eb12d8723eeab4265f9510b7c2}{AddPoint}}(t,\ new\_index,\ closest\_dist\_sq,\ new\_triangles))}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00395\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Trace(\textcolor{stringliteral}{"{}Could\ not\ add\ point"{}});}
\DoxyCodeLine{00397\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ hull\ is\ starting\ to\ form\ defects\ then\ we're\ reaching\ numerical\ precision\ and\ we\ have\ to\ stop}}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_defect\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle}{Triangle}}\ *nt\ :\ new\_triangles)}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nt-\/>IsFacingOrigin())}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ has\_defect\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_defect)}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00411\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Trace(\textcolor{stringliteral}{"{}Has\ defect"{}});}
\DoxyCodeLine{00413\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ JPH\_EPA\_PENETRATION\_DEPTH\_DEBUG}}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ When\ the\ hull\ has\ defects\ it\ is\ possible\ that\ the\ origin\ has\ been\ classified\ on\ the\ wrong\ side\ of\ the\ triangle}}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ so\ we\ do\ an\ additional\ check\ to\ see\ if\ the\ penetration\ in\ the\ -\/triangle\ normal\ direction\ is\ smaller\ than}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ penetration\ in\ the\ triangle\ normal\ direction.\ If\ so\ we\ must\ flip\ the\ sign\ of\ the\ penetration\ depth.}}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ w2\ =\ inAIncludingConvexRadius.GetSupport(-\/t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}})\ -\/\ inBIncludingConvexRadius.GetSupport(t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}});}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ dot2\ =\ -\/t-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(w2);}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dot2\ <\ dot)}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ flip\_v\_sign\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (hull.\mbox{\hyperlink{classEPAConvexHullBuilder_a233403c7274da823fb6b96b539dc5f95}{HasNextTriangle}}()\ \&\&\ support\_points.mY.size()\ <\ cMaxPoints);}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Determine\ closest\ points,\ if\ last\ ==\ null\ it\ means\ the\ hull\ was\ a\ plane\ so\ there's\ no\ penetration}}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (last\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \textcolor{preprocessor}{\#ifdef\ JPH\_EPA\_CONVEX\_BUILDER\_DRAW}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ hull.DrawLabel(\textcolor{stringliteral}{"{}Closest\ found"{}});}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ hull.DrawWireTriangle(*last,\ Color::sWhite);}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ hull.DrawArrow(last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}},\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}}\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.\mbox{\hyperlink{classVec3_a6c6409cad56e4e357f73d43cd719ffe8}{NormalizedOr}}(\mbox{\hyperlink{classVec3_ad03c52ab27761bc1e64e33c47632ba51}{Vec3::sZero}}()),\ Color::sWhite,\ 0.1f);}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ hull.DrawState();}
\DoxyCodeLine{00435\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ penetration\ by\ getting\ the\ vector\ from\ the\ origin\ to\ the\ closest\ point\ on\ the\ triangle:}}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ distance\ =\ (centroid\ -\/\ origin)\ .\ normal\ /\ |normal|,\ closest\ =\ origin\ +\ distance\ *\ normal\ /\ |normal|}}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ outV\ =\ (last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a0452b1c401d15dcc561dad66766d45a9}{mCentroid}}.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}})\ /\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}}.\mbox{\hyperlink{classVec3_aba501a6a474028084799f871c9083dc1}{LengthSq}}())\ *\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a72b60caa9b8ba3cc6380f23b4fe72a02}{mNormal}};}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ penetration\ is\ near\ zero,\ treat\ this\ as\ a\ non\ collision\ since\ we\ cannot\ find\ a\ good\ normal}}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (outV.\mbox{\hyperlink{classVec3_acee93ea875b86bc0f63edebe2b592dbc}{IsNearZero}}())}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ we\ have\ to\ flip\ the\ sign\ of\ the\ penetration\ depth}}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (flip\_v\_sign)}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ outV\ =\ -\/outV;}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Use\ the\ barycentric\ coordinates\ for\ the\ closest\ point\ to\ the\ origin\ to\ find\ the\ contact\ points\ on\ A\ and\ B}}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ p0\ =\ support\_points.mP[last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[0].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}}];}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ p1\ =\ support\_points.mP[last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[1].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}}];}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ p2\ =\ support\_points.mP[last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[2].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}}];}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ q0\ =\ support\_points.mQ[last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[0].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}}];}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ q1\ =\ support\_points.mQ[last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[1].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}}];}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ q2\ =\ support\_points.mQ[last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_a73f39336e0cda2338ca31459de675f4f}{mEdge}}[2].\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Edge_a3198dfe7323ed3f875dca4e00821a53c}{mStartIdx}}];}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_ad717cb9534ef44896e91c33ab4d5ba0c}{mLambdaRelativeTo0}})}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ y0\ was\ the\ reference\ vertex}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \ \ \ \ outPointA\ =\ p0\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_abf3e8715dbc37a34783e322dc2211074}{mLambda}}[0]\ *\ (p1\ -\/\ p0)\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_abf3e8715dbc37a34783e322dc2211074}{mLambda}}[1]\ *\ (p2\ -\/\ p0);}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ outPointB\ =\ q0\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_abf3e8715dbc37a34783e322dc2211074}{mLambda}}[0]\ *\ (q1\ -\/\ q0)\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_abf3e8715dbc37a34783e322dc2211074}{mLambda}}[1]\ *\ (q2\ -\/\ q0);}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ y1\ was\ the\ reference\ vertex}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ outPointA\ =\ p1\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_abf3e8715dbc37a34783e322dc2211074}{mLambda}}[0]\ *\ (p0\ -\/\ p1)\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_abf3e8715dbc37a34783e322dc2211074}{mLambda}}[1]\ *\ (p2\ -\/\ p1);}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ outPointB\ =\ q1\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_abf3e8715dbc37a34783e322dc2211074}{mLambda}}[0]\ *\ (q0\ -\/\ q1)\ +\ last-\/>\mbox{\hyperlink{classEPAConvexHullBuilder_1_1Triangle_abf3e8715dbc37a34783e322dc2211074}{mLambda}}[1]\ *\ (q2\ -\/\ q1);}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00472\ \ \ \ \ \}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00477\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ AE,\ \textcolor{keyword}{typename}\ AI,\ \textcolor{keyword}{typename}\ BE,\ \textcolor{keyword}{typename}\ BI>}
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAPenetrationDepth_a8368ab4825b799eb57d6f6cf841087e2}{GetPenetrationDepth}}(\textcolor{keyword}{const}\ AE\ \&inAExcludingConvexRadius,\ \textcolor{keyword}{const}\ AI\ \&inAIncludingConvexRadius,\ \textcolor{keywordtype}{float}\ inConvexRadiusA,\ \textcolor{keyword}{const}\ BE\ \&inBExcludingConvexRadius,\ \textcolor{keyword}{const}\ BI\ \&inBIncludingConvexRadius,\ \textcolor{keywordtype}{float}\ inConvexRadiusB,\ \textcolor{keywordtype}{float}\ inCollisionToleranceSq,\ \textcolor{keywordtype}{float}\ inPenetrationTolerance,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&ioV,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outPointA,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outPointB)}
\DoxyCodeLine{00479\ \ \ \ \ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ result\ of\ collision\ detection}}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{classEPAPenetrationDepth_a903dc39955aae9b4e9eced5a396eb5a7}{GetPenetrationDepthStepGJK}}(inAExcludingConvexRadius,\ inConvexRadiusA,\ inBExcludingConvexRadius,\ inConvexRadiusB,\ inCollisionToleranceSq,\ ioV,\ outPointA,\ outPointB))}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0ae0f4d0dafbcf08dd28d80154056ad0d8}{EPAPenetrationDepth::EStatus::Colliding}}:}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0a0497a652be066f6f966a97fa6c67c9c0}{EPAPenetrationDepth::EStatus::NotColliding}}:}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classEPAPenetrationDepth_aab59ecfbbefc06c5ac96f9cdc24252d0aa2d00c353d1f9a5f07852650030dbd53}{EPAPenetrationDepth::EStatus::Indeterminate}}:}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEPAPenetrationDepth_acff8a6121c0896e3aabbe3a18019f201}{GetPenetrationDepthStepEPA}}(inAIncludingConvexRadius,\ inBIncludingConvexRadius,\ inPenetrationTolerance,\ ioV,\ outPointA,\ outPointB);}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ JPH\_ASSERT(\textcolor{keyword}{false});}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00495\ \ \ \ \ \}}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00514\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ A,\ \textcolor{keyword}{typename}\ B>}
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEPAPenetrationDepth_a37aeff94cc5402fd0a98bb299803f543}{CastShape}}(\mbox{\hyperlink{classMat44}{Mat44Arg}}\ inStart,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inDirection,\ \textcolor{keywordtype}{float}\ inCollisionTolerance,\ \textcolor{keywordtype}{float}\ inPenetrationTolerance,\ \textcolor{keyword}{const}\ A\ \&inA,\ \textcolor{keyword}{const}\ B\ \&inB,\ \textcolor{keywordtype}{float}\ inConvexRadiusA,\ \textcolor{keywordtype}{float}\ inConvexRadiusB,\ \textcolor{keywordtype}{bool}\ inReturnDeepestPoint,\ \textcolor{keywordtype}{float}\ \&ioLambda,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outPointA,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outPointB,\ \mbox{\hyperlink{classVec3}{Vec3}}\ \&outContactNormal)}
\DoxyCodeLine{00516\ \ \ \ \ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ determine\ if\ there's\ a\ collision\ at\ all}}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!mGJK.\mbox{\hyperlink{classGJKClosestPoint_a66d20557ad6d34a1c1f29b6df058b523}{CastShape}}(inStart,\ inDirection,\ inCollisionTolerance,\ inA,\ inB,\ inConvexRadiusA,\ inConvexRadiusB,\ ioLambda,\ outPointA,\ outPointB,\ outContactNormal))}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ When\ our\ contact\ normal\ is\ too\ small,\ we\ don't\ have\ an\ accurate\ result}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ contact\_normal\_invalid\ =\ outContactNormal.\mbox{\hyperlink{classVec3_acee93ea875b86bc0f63edebe2b592dbc}{IsNearZero}}(Square(inCollisionTolerance));}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inReturnDeepestPoint}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ ioLambda\ ==\ 0.0f\ \textcolor{comment}{//\ Only\ when\ lambda\ =\ 0\ we\ can\ have\ the\ bodies\ overlap}}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ (inConvexRadiusA\ +\ inConvexRadiusB\ ==\ 0.0f\ \textcolor{comment}{//\ When\ no\ convex\ radius\ was\ provided\ we\ can\ never\ trust\ contact\ points\ at\ lambda\ =\ 0}}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ contact\_normal\_invalid))}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we're\ initially\ intersecting,\ we\ need\ to\ run\ the\ EPA\ algorithm\ in\ order\ to\ find\ the\ deepest\ contact\ point}}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structAddConvexRadius}{AddConvexRadius<A>}}\ add\_convex\_a(inA,\ inConvexRadiusA);}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structAddConvexRadius}{AddConvexRadius<B>}}\ add\_convex\_b(inB,\ inConvexRadiusB);}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structTransformedConvexObject}{TransformedConvexObject<AddConvexRadius<A>}}>\ transformed\_a(inStart,\ add\_convex\_a);}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classEPAPenetrationDepth_acff8a6121c0896e3aabbe3a18019f201}{GetPenetrationDepthStepEPA}}(transformed\_a,\ add\_convex\_b,\ inPenetrationTolerance,\ outContactNormal,\ outPointA,\ outPointB))}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (contact\_normal\_invalid)}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ weren't\ able\ to\ calculate\ a\ contact\ normal,\ use\ the\ cast\ direction\ instead}}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \ \ \ outContactNormal\ =\ inDirection;}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00543\ \ \ \ \ \}}
\DoxyCodeLine{00544\ \};}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ JPH\_NAMESPACE\_END}

\end{DoxyCode}
