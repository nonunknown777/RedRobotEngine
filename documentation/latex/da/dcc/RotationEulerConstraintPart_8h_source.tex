\doxysection{Rotation\+Euler\+Constraint\+Part.\+h}
\hypertarget{RotationEulerConstraintPart_8h_source}{}\label{RotationEulerConstraintPart_8h_source}\index{includes/jolt/Physics/Constraints/ConstraintPart/RotationEulerConstraintPart.h@{includes/jolt/Physics/Constraints/ConstraintPart/RotationEulerConstraintPart.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Jolt\ Physics\ Library\ (https://github.com/jrouwe/JoltPhysics)}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ SPDX-\/FileCopyrightText:\ 2021\ Jorrit\ Rouwe}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ SPDX-\/License-\/Identifier:\ MIT}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <Jolt/Physics/Body/Body.h>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <Jolt/Physics/StateRecorder.h>}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ JPH\_NAMESPACE\_BEGIN}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classRotationEulerConstraintPart}{RotationEulerConstraintPart}}}
\DoxyCodeLine{00036\ \{}
\DoxyCodeLine{00037\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00039\ \ \ \ \ JPH\_INLINE\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ ApplyVelocityStep(\mbox{\hyperlink{classBody}{Body}}\ \&ioBody1,\ \mbox{\hyperlink{classBody}{Body}}\ \&ioBody2,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inLambda)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00040\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Apply\ impulse\ if\ delta\ is\ not\ zero}}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inLambda\ !=\ \mbox{\hyperlink{classVec3_ad03c52ab27761bc1e64e33c47632ba51}{Vec3::sZero}}())}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ velocity\ change\ due\ to\ constraint}}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Impulse:}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\ =\ J\string^T\ lambda}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Euler\ velocity\ integration:}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ v'\ =\ v\ +\ M\string^-\/1\ P}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ioBody1.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}())}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ioBody1.\mbox{\hyperlink{classBody_a0d39987255227c4221fcea66cb1fc041}{GetMotionProperties}}()-\/>SubAngularVelocityStep(mInvI1.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(inLambda));}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ioBody2.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}())}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ioBody2.\mbox{\hyperlink{classBody_a0d39987255227c4221fcea66cb1fc041}{GetMotionProperties}}()-\/>AddAngularVelocityStep(mInvI2.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(inLambda));}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00059\ \ \ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classQuat}{Quat}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_a40c10735335691be99e7911139dc2884}{sGetInvInitialOrientation}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classBody}{Body}}\ \&inBody1,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBody}{Body}}\ \&inBody2)}
\DoxyCodeLine{00064\ \ \ \ \ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q20\ =\ q10\ r0}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <=>\ r0\ =\ q10\string^-\/1\ q20}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <=>\ r0\string^-\/1\ =\ q20\string^-\/1\ q10}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ where:}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q20\ =\ initial\ orientation\ of\ body\ 2}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q10\ =\ initial\ orientation\ of\ body\ 1}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ r0\ =\ initial\ rotation\ rotation\ from\ body\ 1\ to\ body\ 2}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ inBody2.\mbox{\hyperlink{classBody_aaee24bfb5e32e756f50113b9d1f45a2c}{GetRotation}}().\mbox{\hyperlink{classQuat_ac69dfd8cdf79a19b8c3f385125ff5ddc}{Conjugated}}()\ *\ inBody1.\mbox{\hyperlink{classBody_aaee24bfb5e32e756f50113b9d1f45a2c}{GetRotation}}();}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classQuat}{Quat}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_a6757c3b96eff4a145d9228fb1679222d}{sGetInvInitialOrientationXY}}(\mbox{\hyperlink{classVec3}{Vec3Arg}}\ inAxisX1,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inAxisY1,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inAxisX2,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inAxisY2)}
\DoxyCodeLine{00083\ \ \ \ \ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Store\ inverse\ of\ initial\ rotation\ from\ body\ 1\ to\ body\ 2\ in\ body\ 1\ space:}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q20\ =\ q10\ r0}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <=>\ r0\ =\ q10\string^-\/1\ q20}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <=>\ r0\string^-\/1\ =\ q20\string^-\/1\ q10}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ where:}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q10,\ q20\ =\ world\ space\ initial\ orientation\ of\ body\ 1\ and\ 2}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ r0\ =\ initial\ rotation\ rotation\ from\ body\ 1\ to\ body\ 2\ in\ local\ space\ of\ body\ 1}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can\ also\ write\ this\ in\ terms\ of\ the\ constraint\ matrices:}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q20\ c2\ =\ q10\ c1}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <=>\ q20\ =\ q10\ c1\ c2\string^-\/1}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ =>\ r0\ =\ c1\ c2\string^-\/1}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <=>\ r0\string^-\/1\ =\ c2\ c1\string^-\/1}}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ where:}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ c1,\ c2\ =\ matrix\ that\ takes\ us\ from\ body\ 1\ and\ 2\ COM\ to\ constraint\ space\ 1\ and\ 2}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inAxisX1\ ==\ inAxisX2\ \&\&\ inAxisY1\ ==\ inAxisY2)}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Axis\ are\ the\ same\ -\/>\ identity\ transform}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classQuat_a73a43fe262fbbbc0b1872d238b972794}{Quat::sIdentity}}();}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ constraint1(\mbox{\hyperlink{classVec4}{Vec4}}(inAxisX1,\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(inAxisY1,\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(inAxisX1.\mbox{\hyperlink{classVec3_a224811af391ccfd1e05282eda22d1de8}{Cross}}(inAxisY1),\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(0,\ 0,\ 0,\ 1));}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ constraint2(\mbox{\hyperlink{classVec4}{Vec4}}(inAxisX2,\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(inAxisY2,\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(inAxisX2.\mbox{\hyperlink{classVec3_a224811af391ccfd1e05282eda22d1de8}{Cross}}(inAxisY2),\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(0,\ 0,\ 0,\ 1));}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ constraint2.\mbox{\hyperlink{classMat44_a1e977c53b5f6a0c03f8da33ebef2c05a}{GetQuaternion}}()\ *\ constraint1.\mbox{\hyperlink{classMat44_a1e977c53b5f6a0c03f8da33ebef2c05a}{GetQuaternion}}().\mbox{\hyperlink{classQuat_ac69dfd8cdf79a19b8c3f385125ff5ddc}{Conjugated}}();}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classQuat}{Quat}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_ae84f7a33a2d609dd5138c9a7f3f82f65}{sGetInvInitialOrientationXZ}}(\mbox{\hyperlink{classVec3}{Vec3Arg}}\ inAxisX1,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inAxisZ1,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inAxisX2,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inAxisZ2)}
\DoxyCodeLine{00124\ \ \ \ \ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ See\ comment\ at\ sGetInvInitialOrientationXY}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inAxisX1\ ==\ inAxisX2\ \&\&\ inAxisZ1\ ==\ inAxisZ2)}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classQuat_a73a43fe262fbbbc0b1872d238b972794}{Quat::sIdentity}}();}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ constraint1(\mbox{\hyperlink{classVec4}{Vec4}}(inAxisX1,\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(inAxisZ1.\mbox{\hyperlink{classVec3_a224811af391ccfd1e05282eda22d1de8}{Cross}}(inAxisX1),\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(inAxisZ1,\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(0,\ 0,\ 0,\ 1));}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ constraint2(\mbox{\hyperlink{classVec4}{Vec4}}(inAxisX2,\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(inAxisZ2.\mbox{\hyperlink{classVec3_a224811af391ccfd1e05282eda22d1de8}{Cross}}(inAxisX2),\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(inAxisZ2,\ 0),\ \mbox{\hyperlink{classVec4}{Vec4}}(0,\ 0,\ 0,\ 1));}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ constraint2.\mbox{\hyperlink{classMat44_a1e977c53b5f6a0c03f8da33ebef2c05a}{GetQuaternion}}()\ *\ constraint1.\mbox{\hyperlink{classMat44_a1e977c53b5f6a0c03f8da33ebef2c05a}{GetQuaternion}}().\mbox{\hyperlink{classQuat_ac69dfd8cdf79a19b8c3f385125ff5ddc}{Conjugated}}();}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \ \ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_af37f613895af10af42c71f644fe3f2f5}{CalculateConstraintProperties}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classBody}{Body}}\ \&inBody1,\ \mbox{\hyperlink{classMat44}{Mat44Arg}}\ inRotation1,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBody}{Body}}\ \&inBody2,\ \mbox{\hyperlink{classMat44}{Mat44Arg}}\ inRotation2)}
\DoxyCodeLine{00140\ \ \ \ \ \{}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ properties\ used\ during\ constraint\ solving}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ mInvI1\ =\ inBody1.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}()?\ inBody1.\mbox{\hyperlink{classBody_a0d39987255227c4221fcea66cb1fc041}{GetMotionProperties}}()-\/>\mbox{\hyperlink{classMotionProperties_ab95f2b1c9b6bd9b6082f8cee8a7e1858}{GetInverseInertiaForRotation}}(inRotation1)\ :\ \mbox{\hyperlink{classMat44_a1e3a8da1cf3a631ffaf478ca3f6bb1ed}{Mat44::sZero}}();}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ mInvI2\ =\ inBody2.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}()?\ inBody2.\mbox{\hyperlink{classBody_a0d39987255227c4221fcea66cb1fc041}{GetMotionProperties}}()-\/>\mbox{\hyperlink{classMotionProperties_ab95f2b1c9b6bd9b6082f8cee8a7e1858}{GetInverseInertiaForRotation}}(inRotation2)\ :\ \mbox{\hyperlink{classMat44_a1e3a8da1cf3a631ffaf478ca3f6bb1ed}{Mat44::sZero}}();}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ effective\ mass:\ K\string^-\/1\ =\ (J\ M\string^-\/1\ J\string^T)\string^-\/1}}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!mEffectiveMass.\mbox{\hyperlink{classMat44_a814c04077820ea83f444ccc5ae48299f}{SetInversed3x3}}(mInvI1\ +\ mInvI2))}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_ab5ff022582eb45db942a196a32795661}{Deactivate}}();}
\DoxyCodeLine{00148\ \ \ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_ab5ff022582eb45db942a196a32795661}{Deactivate}}()}
\DoxyCodeLine{00152\ \ \ \ \ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ mEffectiveMass\ =\ \mbox{\hyperlink{classMat44_a1e3a8da1cf3a631ffaf478ca3f6bb1ed}{Mat44::sZero}}();}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ mTotalLambda\ =\ \mbox{\hyperlink{classVec3_ad03c52ab27761bc1e64e33c47632ba51}{Vec3::sZero}}();}
\DoxyCodeLine{00155\ \ \ \ \ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_a5580f01673bcbbde31fd75108d2866b4}{IsActive}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00159\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mEffectiveMass(3,\ 3)\ !=\ 0.0f;}
\DoxyCodeLine{00161\ \ \ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_a492a0801dd2881d0ab58f9c8b0abfec8}{WarmStart}}(\mbox{\hyperlink{classBody}{Body}}\ \&ioBody1,\ \mbox{\hyperlink{classBody}{Body}}\ \&ioBody2,\ \textcolor{keywordtype}{float}\ inWarmStartImpulseRatio)}
\DoxyCodeLine{00165\ \ \ \ \ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ mTotalLambda\ *=\ inWarmStartImpulseRatio;}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ ApplyVelocityStep(ioBody1,\ ioBody2,\ mTotalLambda);}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_af9a7e556643d4162eb300045d9a40df1}{SolveVelocityConstraint}}(\mbox{\hyperlink{classBody}{Body}}\ \&ioBody1,\ \mbox{\hyperlink{classBody}{Body}}\ \&ioBody2)}
\DoxyCodeLine{00172\ \ \ \ \ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ lagrange\ multiplier:}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lambda\ =\ -\/K\string^-\/1\ (J\ v\ +\ b)}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ lambda\ =\ mEffectiveMass.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(ioBody1.\mbox{\hyperlink{classBody_adb1bb49db094ac2ef7c4951d07ba8417}{GetAngularVelocity}}()\ -\/\ ioBody2.\mbox{\hyperlink{classBody_adb1bb49db094ac2ef7c4951d07ba8417}{GetAngularVelocity}}());}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ mTotalLambda\ +=\ lambda;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ApplyVelocityStep(ioBody1,\ ioBody2,\ lambda);}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_ab2276b37dd0f8eaf4229469def2627b6}{SolvePositionConstraint}}(\mbox{\hyperlink{classBody}{Body}}\ \&ioBody1,\ \mbox{\hyperlink{classBody}{Body}}\ \&ioBody2,\ \mbox{\hyperlink{classQuat}{QuatArg}}\ inInvInitialOrientation,\ \textcolor{keywordtype}{float}\ inBaumgarte)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00183\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ difference\ in\ rotation}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ rotation\ should\ be:}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q2\ =\ q1\ r0}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ But\ because\ of\ drift\ the\ actual\ rotation\ is}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q2\ =\ diff\ q1\ r0}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <=>\ diff\ =\ q2\ r0\string^-\/1\ q1\string^-\/1}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Where:}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q1\ =\ current\ rotation\ of\ body\ 1}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q2\ =\ current\ rotation\ of\ body\ 2}}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ diff\ =\ error\ that\ needs\ to\ be\ reduced\ to\ zero}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classQuat}{Quat}}\ diff\ =\ ioBody2.\mbox{\hyperlink{classBody_aaee24bfb5e32e756f50113b9d1f45a2c}{GetRotation}}()\ *\ inInvInitialOrientation\ *\ ioBody1.\mbox{\hyperlink{classBody_aaee24bfb5e32e756f50113b9d1f45a2c}{GetRotation}}().\mbox{\hyperlink{classQuat_ac69dfd8cdf79a19b8c3f385125ff5ddc}{Conjugated}}();}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ quaternion\ can\ be\ seen\ as:}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ q\ =\ [sin(theta\ /\ 2)\ *\ v,\ cos(theta/2)]}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Where:}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ v\ =\ rotation\ vector}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ theta\ =\ rotation\ angle}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ assume\ theta\ is\ small\ (error\ is\ small)\ then\ sin(x)\ =\ x\ so\ an\ approximation\ of\ the\ error\ angles\ is:}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ error\ =\ 2.0f\ *\ diff.\mbox{\hyperlink{classQuat_a9f563ca8c8a8b71a0aa340d12080c2ef}{EnsureWPositive}}().\mbox{\hyperlink{classQuat_afa7fe10bf8a457fb2d524791ccd79ec4}{GetXYZ}}();}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ !=\ \mbox{\hyperlink{classVec3_ad03c52ab27761bc1e64e33c47632ba51}{Vec3::sZero}}())}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ lagrange\ multiplier\ (lambda)\ for\ Baumgarte\ stabilization:}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lambda\ =\ -\/K\string^-\/1\ *\ beta\ /\ dt\ *\ C}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ should\ divide\ by\ inDeltaTime,\ but\ we\ should\ multiply\ by\ inDeltaTime\ in\ the\ Euler\ step\ below\ so\ they're\ cancelled\ out}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ lambda\ =\ -\/inBaumgarte\ *\ mEffectiveMass\ *\ error;}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Directly\ integrate\ velocity\ change\ for\ one\ time\ step}}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Euler\ velocity\ integration:}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dv\ =\ M\string^-\/1\ P}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Impulse:}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\ =\ J\string^T\ lambda}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Euler\ position\ integration:}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ x'\ =\ x\ +\ dv\ *\ dt}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note\ we\ don't\ accumulate\ velocities\ for\ the\ stabilization.\ This\ is\ using\ the\ approach\ described\ in\ 'Modeling\ and}}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Solving\ Constraints'\ by\ Erin\ Catto\ presented\ at\ GDC\ 2007.\ On\ slide\ 78\ it\ is\ suggested\ to\ split\ up\ the\ Baumgarte}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ stabilization\ for\ positional\ drift\ so\ that\ it\ does\ not\ actually\ add\ to\ the\ momentum.\ We\ combine\ an\ Euler\ velocity}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ integrate\ +\ a\ position\ integrate\ and\ then\ discard\ the\ velocity\ change.}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ioBody1.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}())}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ioBody1.SubRotationStep(mInvI1.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(lambda));}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ioBody2.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}())}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ioBody2.\mbox{\hyperlink{classBody_a3385650a73d75c7d9c16d13ea2d5519f}{AddRotationStep}}(mInvI2.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(lambda));}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00246\ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_aada1e7c8fcf62c1674aa5080cd70687e}{GetTotalLambda}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00247\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mTotalLambda;}
\DoxyCodeLine{00249\ \ \ \ \ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_afda34f355272d02e5daf8103639b22bf}{SaveState}}(\mbox{\hyperlink{classStateRecorder}{StateRecorder}}\ \&inStream)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00253\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ inStream.\mbox{\hyperlink{classStreamOut_ab6cde59b6c5efff58855641a44e6275e}{Write}}(mTotalLambda);}
\DoxyCodeLine{00255\ \ \ \ \ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classRotationEulerConstraintPart_aba8f2a3ca2aa7ab982b16499cf938ee3}{RestoreState}}(\mbox{\hyperlink{classStateRecorder}{StateRecorder}}\ \&inStream)}
\DoxyCodeLine{00259\ \ \ \ \ \{}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ inStream.\mbox{\hyperlink{classStreamIn_a2a6ed7571089f1156ee7a480b67c22d1}{Read}}(mTotalLambda);}
\DoxyCodeLine{00261\ \ \ \ \ \}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00264\ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mInvI1;}
\DoxyCodeLine{00265\ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mInvI2;}
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mEffectiveMass;}
\DoxyCodeLine{00267\ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mTotalLambda\ \{\ \mbox{\hyperlink{classVec3_ad03c52ab27761bc1e64e33c47632ba51}{Vec3::sZero}}()\ \};}
\DoxyCodeLine{00268\ \};}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ JPH\_NAMESPACE\_END}

\end{DoxyCode}
