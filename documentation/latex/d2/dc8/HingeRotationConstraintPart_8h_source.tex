\doxysection{Hinge\+Rotation\+Constraint\+Part.\+h}
\hypertarget{HingeRotationConstraintPart_8h_source}{}\label{HingeRotationConstraintPart_8h_source}\index{includes/jolt/Physics/Constraints/ConstraintPart/HingeRotationConstraintPart.h@{includes/jolt/Physics/Constraints/ConstraintPart/HingeRotationConstraintPart.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Jolt\ Physics\ Library\ (https://github.com/jrouwe/JoltPhysics)}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ SPDX-\/FileCopyrightText:\ 2021\ Jorrit\ Rouwe}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ SPDX-\/License-\/Identifier:\ MIT}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <Jolt/Physics/Body/Body.h>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <Jolt/Physics/StateRecorder.h>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <Jolt/Math/Vector.h>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <Jolt/Math/Matrix.h>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ JPH\_NAMESPACE\_BEGIN}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00043\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classHingeRotationConstraintPart}{HingeRotationConstraintPart}}}
\DoxyCodeLine{00044\ \{}
\DoxyCodeLine{00045\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classVector}{Vec2}}\ =\ \mbox{\hyperlink{classVector}{Vector<2>}};}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classMatrix}{Mat22}}\ =\ \mbox{\hyperlink{classMatrix}{Matrix<2,\ 2>}};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00051\ \ \ \ \ JPH\_INLINE\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ ApplyVelocityStep(\mbox{\hyperlink{classBody}{Body}}\ \&ioBody1,\ \mbox{\hyperlink{classBody}{Body}}\ \&ioBody2,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classVector}{Vec2}}\ \&inLambda)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00052\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Apply\ impulse\ if\ delta\ is\ not\ zero}}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!inLambda.\mbox{\hyperlink{classVector_ab1368364228755bfe9e64af3654ea995}{IsZero}}())}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ velocity\ change\ due\ to\ constraint}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Impulse:}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\ =\ J\string^T\ lambda}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Euler\ velocity\ integration:}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ v'\ =\ v\ +\ M\string^-\/1\ P}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ impulse\ =\ mB2xA1\ *\ inLambda[0]\ +\ mC2xA1\ *\ inLambda[1];}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ioBody1.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}())}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ioBody1.\mbox{\hyperlink{classBody_a0d39987255227c4221fcea66cb1fc041}{GetMotionProperties}}()-\/>SubAngularVelocityStep(mInvI1.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(impulse));}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ioBody2.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}())}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ioBody2.\mbox{\hyperlink{classBody_a0d39987255227c4221fcea66cb1fc041}{GetMotionProperties}}()-\/>AddAngularVelocityStep(mInvI2.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(impulse));}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00072\ \ \ \ \ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_a41471ce4cbe4f3b915ba40f883a3f924}{CalculateConstraintProperties}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classBody}{Body}}\ \&inBody1,\ \mbox{\hyperlink{classMat44}{Mat44Arg}}\ inRotation1,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inWorldSpaceHingeAxis1,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBody}{Body}}\ \&inBody2,\ \mbox{\hyperlink{classMat44}{Mat44Arg}}\ inRotation2,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inWorldSpaceHingeAxis2)}
\DoxyCodeLine{00077\ \ \ \ \ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ JPH\_ASSERT(inWorldSpaceHingeAxis1.\mbox{\hyperlink{classVec3_a2f10743d69960eaac721399e4ede190a}{IsNormalized}}(1.0e-\/5f));}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ JPH\_ASSERT(inWorldSpaceHingeAxis2.\mbox{\hyperlink{classVec3_a2f10743d69960eaac721399e4ede190a}{IsNormalized}}(1.0e-\/5f));}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ hinge\ axis\ in\ world\ space}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ mA1\ =\ inWorldSpaceHingeAxis1;}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ a2\ =\ inWorldSpaceHingeAxis2;}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ dot\ =\ mA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(a2);}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dot\ <=\ 1.0e-\/3f)}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ World\ space\ axes\ are\ more\ than\ 90\ degrees\ apart,\ get\ a\ perpendicular\ vector\ in\ the\ plane\ formed\ by\ mA1\ and\ a2\ as\ hinge\ axis\ until\ the\ rotation\ is\ less\ than\ 90\ degrees}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ perp\ =\ a2\ -\/\ dot\ *\ mA1;}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (perp.\mbox{\hyperlink{classVec3_aba501a6a474028084799f871c9083dc1}{LengthSq}}()\ <\ 1.0e-\/6f)}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ mA1\ \string~\ -\/a2,\ take\ random\ perpendicular}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ perp\ =\ mA1.\mbox{\hyperlink{classVec3_a24a96972fdbe04ae9a3e340fd4c39b81}{GetNormalizedPerpendicular}}();}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Blend\ in\ a\ little\ bit\ from\ mA1\ so\ we're\ less\ than\ 90\ degrees\ apart}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ a2\ =\ (0.99f\ *\ perp.\mbox{\hyperlink{classVec3_a0f7559f2691ad67826f42ca19916b7a9}{Normalized}}()\ +\ 0.01f\ *\ mA1).Normalized();}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ mB2\ =\ a2.\mbox{\hyperlink{classVec3_a24a96972fdbe04ae9a3e340fd4c39b81}{GetNormalizedPerpendicular}}();}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ mC2\ =\ a2.\mbox{\hyperlink{classVec3_a224811af391ccfd1e05282eda22d1de8}{Cross}}(mB2);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ properties\ used\ during\ constraint\ solving}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ mInvI1\ =\ inBody1.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}()?\ inBody1.\mbox{\hyperlink{classBody_a0d39987255227c4221fcea66cb1fc041}{GetMotionProperties}}()-\/>\mbox{\hyperlink{classMotionProperties_ab95f2b1c9b6bd9b6082f8cee8a7e1858}{GetInverseInertiaForRotation}}(inRotation1)\ :\ \mbox{\hyperlink{classMat44_a1e3a8da1cf3a631ffaf478ca3f6bb1ed}{Mat44::sZero}}();}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ mInvI2\ =\ inBody2.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}()?\ inBody2.\mbox{\hyperlink{classBody_a0d39987255227c4221fcea66cb1fc041}{GetMotionProperties}}()-\/>\mbox{\hyperlink{classMotionProperties_ab95f2b1c9b6bd9b6082f8cee8a7e1858}{GetInverseInertiaForRotation}}(inRotation2)\ :\ \mbox{\hyperlink{classMat44_a1e3a8da1cf3a631ffaf478ca3f6bb1ed}{Mat44::sZero}}();}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ mB2xA1\ =\ mB2.\mbox{\hyperlink{classVec3_a224811af391ccfd1e05282eda22d1de8}{Cross}}(mA1);}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ mC2xA1\ =\ mC2.\mbox{\hyperlink{classVec3_a224811af391ccfd1e05282eda22d1de8}{Cross}}(mA1);}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ effective\ mass:\ K\string^-\/1\ =\ (J\ M\string^-\/1\ J\string^T)\string^-\/1}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ summed\_inv\_inertia\ =\ mInvI1\ +\ mInvI2;}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMatrix}{Mat22}}\ inv\_effective\_mass;}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ inv\_effective\_mass(0,\ 0)\ =\ mB2xA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(summed\_inv\_inertia.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(mB2xA1));}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ inv\_effective\_mass(0,\ 1)\ =\ mB2xA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(summed\_inv\_inertia.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(mC2xA1));}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ inv\_effective\_mass(1,\ 0)\ =\ mC2xA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(summed\_inv\_inertia.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(mB2xA1));}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ inv\_effective\_mass(1,\ 1)\ =\ mC2xA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(summed\_inv\_inertia.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(mC2xA1));}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!mEffectiveMass.\mbox{\hyperlink{classMatrix_a1e2531318f995ae102d4428c3bdba738}{SetInversed}}(inv\_effective\_mass))}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_a4ae072cae1beb84f1e87eafff60f0022}{Deactivate}}();}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_a4ae072cae1beb84f1e87eafff60f0022}{Deactivate}}()}
\DoxyCodeLine{00120\ \ \ \ \ \{}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ mEffectiveMass.\mbox{\hyperlink{classMatrix_a7b98e3c672cc83e50b0cb6cf33b1ec65}{SetZero}}();}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ mTotalLambda.\mbox{\hyperlink{classVector_a06ffa8aa3d40e7c93dde19725e77ff3a}{SetZero}}();}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_aa71c15ea49da0d82a70d8edf787f612b}{WarmStart}}(\mbox{\hyperlink{classBody}{Body}}\ \&ioBody1,\ \mbox{\hyperlink{classBody}{Body}}\ \&ioBody2,\ \textcolor{keywordtype}{float}\ inWarmStartImpulseRatio)}
\DoxyCodeLine{00127\ \ \ \ \ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ mTotalLambda\ *=\ inWarmStartImpulseRatio;}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ ApplyVelocityStep(ioBody1,\ ioBody2,\ mTotalLambda);}
\DoxyCodeLine{00130\ \ \ \ \ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_aabd46260672295ed6df506bf81a2f326}{SolveVelocityConstraint}}(\mbox{\hyperlink{classBody}{Body}}\ \&ioBody1,\ \mbox{\hyperlink{classBody}{Body}}\ \&ioBody2)}
\DoxyCodeLine{00134\ \ \ \ \ \{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ lagrange\ multiplier:}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lambda\ =\ -\/K\string^-\/1\ (J\ v\ +\ b)}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ delta\_ang\ =\ ioBody1.\mbox{\hyperlink{classBody_adb1bb49db094ac2ef7c4951d07ba8417}{GetAngularVelocity}}()\ -\/\ ioBody2.\mbox{\hyperlink{classBody_adb1bb49db094ac2ef7c4951d07ba8417}{GetAngularVelocity}}();}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVector}{Vec2}}\ jv;}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ jv[0]\ =\ mB2xA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(delta\_ang);}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ jv[1]\ =\ mC2xA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(delta\_ang);}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVector}{Vec2}}\ lambda\ =\ mEffectiveMass\ *\ jv;}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Store\ accumulated\ lambda}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ mTotalLambda\ +=\ lambda;}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ApplyVelocityStep(ioBody1,\ ioBody2,\ lambda);}
\DoxyCodeLine{00148\ \ \ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_a0f4c769c027f4efb2511d74f9658d8eb}{SolvePositionConstraint}}(\mbox{\hyperlink{classBody}{Body}}\ \&ioBody1,\ \mbox{\hyperlink{classBody}{Body}}\ \&ioBody2,\ \textcolor{keywordtype}{float}\ inBaumgarte)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00152\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Constraint\ needs\ Axis\ of\ body\ 1\ perpendicular\ to\ both\ B\ and\ C\ from\ body\ 2\ (which\ are\ both\ perpendicular\ to\ the\ Axis\ of\ body\ 2)}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVector}{Vec2}}\ c;}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ c[0]\ =\ mA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(mB2);}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ c[1]\ =\ mA1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(mC2);}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!c.\mbox{\hyperlink{classVector_ab1368364228755bfe9e64af3654ea995}{IsZero}}())}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ lagrange\ multiplier\ (lambda)\ for\ Baumgarte\ stabilization:}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lambda\ =\ -\/K\string^-\/1\ *\ beta\ /\ dt\ *\ C}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ should\ divide\ by\ inDeltaTime,\ but\ we\ should\ multiply\ by\ inDeltaTime\ in\ the\ Euler\ step\ below\ so\ they're\ cancelled\ out}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVector}{Vec2}}\ lambda\ =\ -\/inBaumgarte\ *\ (mEffectiveMass\ *\ c);}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Directly\ integrate\ velocity\ change\ for\ one\ time\ step}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Euler\ velocity\ integration:}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dv\ =\ M\string^-\/1\ P}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Impulse:}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\ =\ J\string^T\ lambda}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Euler\ position\ integration:}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ x'\ =\ x\ +\ dv\ *\ dt}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note\ we\ don't\ accumulate\ velocities\ for\ the\ stabilization.\ This\ is\ using\ the\ approach\ described\ in\ 'Modeling\ and}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Solving\ Constraints'\ by\ Erin\ Catto\ presented\ at\ GDC\ 2007.\ On\ slide\ 78\ it\ is\ suggested\ to\ split\ up\ the\ Baumgarte}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ stabilization\ for\ positional\ drift\ so\ that\ it\ does\ not\ actually\ add\ to\ the\ momentum.\ We\ combine\ an\ Euler\ velocity}}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ integrate\ +\ a\ position\ integrate\ and\ then\ discard\ the\ velocity\ change.}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ impulse\ =\ mB2xA1\ *\ lambda[0]\ +\ mC2xA1\ *\ lambda[1];}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ioBody1.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}())}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ioBody1.SubRotationStep(mInvI1.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(impulse));}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ioBody2.\mbox{\hyperlink{classBody_a1b21c30907c8c9ce30c176a054057bef}{IsDynamic}}())}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ioBody2.\mbox{\hyperlink{classBody_a3385650a73d75c7d9c16d13ea2d5519f}{AddRotationStep}}(mInvI2.\mbox{\hyperlink{classMat44_ab599aaeab3e4b832f7f4097816650b14}{Multiply3x3}}(impulse));}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00190\ \ \ \ \ \}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classVector}{Vec2}}\ \&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_aa99c7f68df35ac1e3bef098c7e20225b}{GetTotalLambda}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00194\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mTotalLambda;}
\DoxyCodeLine{00196\ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_aa35cc45b0e9cfbb7063508e24c677879}{SaveState}}(\mbox{\hyperlink{classStateRecorder}{StateRecorder}}\ \&inStream)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00200\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ inStream.\mbox{\hyperlink{classStreamOut_ab6cde59b6c5efff58855641a44e6275e}{Write}}(mTotalLambda);}
\DoxyCodeLine{00202\ \ \ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classHingeRotationConstraintPart_abf5e533e782c69c89481e4bf6e3a0a28}{RestoreState}}(\mbox{\hyperlink{classStateRecorder}{StateRecorder}}\ \&inStream)}
\DoxyCodeLine{00206\ \ \ \ \ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ inStream.\mbox{\hyperlink{classStreamIn_a2a6ed7571089f1156ee7a480b67c22d1}{Read}}(mTotalLambda);}
\DoxyCodeLine{00208\ \ \ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00211\ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mA1;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00212\ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mB2;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00213\ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mC2;}
\DoxyCodeLine{00214\ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mInvI1;}
\DoxyCodeLine{00215\ \ \ \ \ \mbox{\hyperlink{classMat44}{Mat44}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mInvI2;}
\DoxyCodeLine{00216\ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mB2xA1;}
\DoxyCodeLine{00217\ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mC2xA1;}
\DoxyCodeLine{00218\ \ \ \ \ Mat22\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mEffectiveMass;}
\DoxyCodeLine{00219\ \ \ \ \ Vec2\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mTotalLambda\ \{\ Vec2::sZero()\ \};}
\DoxyCodeLine{00220\ \};}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ JPH\_NAMESPACE\_END}

\end{DoxyCode}
