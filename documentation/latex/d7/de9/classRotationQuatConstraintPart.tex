\doxysection{Rotation\+Quat\+Constraint\+Part Class Reference}
\hypertarget{classRotationQuatConstraintPart}{}\label{classRotationQuatConstraintPart}\index{RotationQuatConstraintPart@{RotationQuatConstraintPart}}


{\ttfamily \#include $<$Rotation\+Quat\+Constraint\+Part.\+h$>$}



Collaboration diagram for Rotation\+Quat\+Constraint\+Part\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=253pt]{df/d9f/classRotationQuatConstraintPart__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classRotationQuatConstraintPart_a0c752c045f216b2d9c0570faf3f71c44}\label{classRotationQuatConstraintPart_a0c752c045f216b2d9c0570faf3f71c44} 
void {\bfseries Calculate\+Constraint\+Properties} (const \mbox{\hyperlink{classBody}{Body}} \&in\+Body1, \mbox{\hyperlink{classMat44}{Mat44\+Arg}} in\+Rotation1, const \mbox{\hyperlink{classBody}{Body}} \&in\+Body2, \mbox{\hyperlink{classMat44}{Mat44\+Arg}} in\+Rotation2, \mbox{\hyperlink{classQuat}{Quat\+Arg}} in\+Inv\+Initial\+Orientation)
\begin{DoxyCompactList}\small\item\em Calculate properties used during the functions below. \end{DoxyCompactList}\item 
\Hypertarget{classRotationQuatConstraintPart_a6fbaaa5c64ed9b01753780cbad3efb8b}\label{classRotationQuatConstraintPart_a6fbaaa5c64ed9b01753780cbad3efb8b} 
void {\bfseries Deactivate} ()
\begin{DoxyCompactList}\small\item\em Deactivate this constraint. \end{DoxyCompactList}\item 
\Hypertarget{classRotationQuatConstraintPart_ab38b8a217a4dc990ed58e9dc7210e2fc}\label{classRotationQuatConstraintPart_ab38b8a217a4dc990ed58e9dc7210e2fc} 
bool {\bfseries Is\+Active} () const
\begin{DoxyCompactList}\small\item\em Check if constraint is active. \end{DoxyCompactList}\item 
\Hypertarget{classRotationQuatConstraintPart_a05fa3097154059e8d7814370182a7aa5}\label{classRotationQuatConstraintPart_a05fa3097154059e8d7814370182a7aa5} 
void {\bfseries Warm\+Start} (\mbox{\hyperlink{classBody}{Body}} \&io\+Body1, \mbox{\hyperlink{classBody}{Body}} \&io\+Body2, float in\+Warm\+Start\+Impulse\+Ratio)
\begin{DoxyCompactList}\small\item\em Must be called from the Warm\+Start\+Velocity\+Constraint call to apply the previous frame\textquotesingle{}s impulses. \end{DoxyCompactList}\item 
\Hypertarget{classRotationQuatConstraintPart_ad464b428f6994ee02ac203b29c561324}\label{classRotationQuatConstraintPart_ad464b428f6994ee02ac203b29c561324} 
bool {\bfseries Solve\+Velocity\+Constraint} (\mbox{\hyperlink{classBody}{Body}} \&io\+Body1, \mbox{\hyperlink{classBody}{Body}} \&io\+Body2)
\begin{DoxyCompactList}\small\item\em Iteratively update the velocity constraint. Makes sure d/dt C(...) = 0, where C is the constraint equation. \end{DoxyCompactList}\item 
\Hypertarget{classRotationQuatConstraintPart_a598d2320bf1b6d19985a183d06183f13}\label{classRotationQuatConstraintPart_a598d2320bf1b6d19985a183d06183f13} 
bool {\bfseries Solve\+Position\+Constraint} (\mbox{\hyperlink{classBody}{Body}} \&io\+Body1, \mbox{\hyperlink{classBody}{Body}} \&io\+Body2, \mbox{\hyperlink{classQuat}{Quat\+Arg}} in\+Inv\+Initial\+Orientation, float in\+Baumgarte) const
\begin{DoxyCompactList}\small\item\em Iteratively update the position constraint. Makes sure C(...) = 0. \end{DoxyCompactList}\item 
\Hypertarget{classRotationQuatConstraintPart_a4aaed47e0905087e32e5dc82f6c4dca5}\label{classRotationQuatConstraintPart_a4aaed47e0905087e32e5dc82f6c4dca5} 
\mbox{\hyperlink{classVec3}{Vec3}} {\bfseries Get\+Total\+Lambda} () const
\begin{DoxyCompactList}\small\item\em Return lagrange multiplier. \end{DoxyCompactList}\item 
\Hypertarget{classRotationQuatConstraintPart_a9ca6e071472fdc3e1ce31b115bfee6e4}\label{classRotationQuatConstraintPart_a9ca6e071472fdc3e1ce31b115bfee6e4} 
void {\bfseries Save\+State} (\mbox{\hyperlink{classStateRecorder}{State\+Recorder}} \&in\+Stream) const
\begin{DoxyCompactList}\small\item\em Save state of this constraint part. \end{DoxyCompactList}\item 
\Hypertarget{classRotationQuatConstraintPart_a95e793a001df59cd2e8ea7e92c4f6263}\label{classRotationQuatConstraintPart_a95e793a001df59cd2e8ea7e92c4f6263} 
void {\bfseries Restore\+State} (\mbox{\hyperlink{classStateRecorder}{State\+Recorder}} \&in\+Stream)
\begin{DoxyCompactList}\small\item\em Restore state of this constraint part. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classRotationQuatConstraintPart_a8ab9f2a8f10bdbbe8000f7af5f0b7b5b}\label{classRotationQuatConstraintPart_a8ab9f2a8f10bdbbe8000f7af5f0b7b5b} 
static \mbox{\hyperlink{classQuat}{Quat}} {\bfseries s\+Get\+Inv\+Initial\+Orientation} (const \mbox{\hyperlink{classBody}{Body}} \&in\+Body1, const \mbox{\hyperlink{classBody}{Body}} \&in\+Body2)
\begin{DoxyCompactList}\small\item\em Return inverse of initial rotation from body 1 to body 2 in body 1 space. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Quaternion based constraint that constrains rotation around all axis so that only translation is allowed.

NOTE\+: This constraint part is more expensive than the \doxylink{classRotationEulerConstraintPart}{Rotation\+Euler\+Constraint\+Part} and slightly more correct since \doxylink{classRotationEulerConstraintPart_ab2276b37dd0f8eaf4229469def2627b6}{Rotation\+Euler\+Constraint\+Part\+::\+Solve\+Position\+Constraint} contains an approximation. In practice the difference is small, so the \doxylink{classRotationEulerConstraintPart}{Rotation\+Euler\+Constraint\+Part} is probably the better choice.

Rotation is fixed between bodies like this\+:

q2 = q1 r0

Where\+: q1, q2 = world space quaternions representing rotation of body 1 and 2. r0 = initial rotation between bodies in local space of body 1, this can be calculated by\+:

q20 = q10 r0 \texorpdfstring{$<$}{<}=\texorpdfstring{$>$}{>} r0 = q10\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} q20

Where\+: q10, q20 = initial world space rotations of body 1 and 2. q10\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} = conjugate of quaternion q10 (which is the same as the inverse for a unit quaternion)

We exclusively use the conjugate below\+:

r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} = q20\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} q10

The error in the rotation is (in local space of body 1)\+:

q2 = q1 error r0 \texorpdfstring{$<$}{<}=\texorpdfstring{$>$}{>} error = q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} q2 r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}

The imaginary part of the quaternion represents the rotation axis \texorpdfstring{$\ast$}{*} sin(angle / 2). The real part of the quaternion does not add any additional information (we know the quaternion in normalized) and we\textquotesingle{}re removing 3 degrees of freedom so we want 3 parameters. Therefore we define the constraint equation like\+:

C = A q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} q2 r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} = 0

Where (if you write a quaternion as \mbox{[}real-\/part, i-\/part, j-\/part, k-\/part\mbox{]})\+: \begin{DoxyVerb}    [0, 1, 0, 0]
A = [0, 0, 1, 0]
    [0, 0, 0, 1]
\end{DoxyVerb}
 or in our case since we store a quaternion like \mbox{[}i-\/part, j-\/part, k-\/part, real-\/part\mbox{]}\+: \begin{DoxyVerb}    [1, 0, 0, 0]
A = [0, 1, 0, 0]
    [0, 0, 1, 0]
\end{DoxyVerb}
 Time derivative\+:

d/dt C = A (q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} d/dt(q2) + d/dt(q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) q2) r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} = A (q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} (1/2 W2 q2) + (1/2 W1 q1)\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} q2) r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} = 1/2 A (q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} W2 q2 + q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} W1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} q2) r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} = 1/2 A (q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} W2 q2 -\/ q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} W1 \texorpdfstring{$\ast$}{*} q2) r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} = 1/2 A ML(q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) MR(q2 r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) (W2 -\/ W1) = 1/2 A ML(q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) MR(q2 r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) A\texorpdfstring{$^\wedge$}{\string^}T (w2 -\/ w1)

Where\+: W1 = \mbox{[}0, w1\mbox{]}, W2 = \mbox{[}0, w2\mbox{]} (converting angular velocity to imaginary part of quaternion). w1, w2 = angular velocity of body 1 and 2. d/dt(q) = 1/2 W q (time derivative of a quaternion). W\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*} = -\/W (conjugate negates angular velocity as quaternion). ML(q)\+: 4x4 matrix so that q \texorpdfstring{$\ast$}{*} p = ML(q) \texorpdfstring{$\ast$}{*} p, where q and p are quaternions. MR(p)\+: 4x4 matrix so that q \texorpdfstring{$\ast$}{*} p = MR(p) \texorpdfstring{$\ast$}{*} q, where q and p are quaternions. A\texorpdfstring{$^\wedge$}{\string^}T\+: Transpose of A.

Jacobian\+:

J = \mbox{[}0, -\/1/2 A ML(q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) MR(q2 r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) A\texorpdfstring{$^\wedge$}{\string^}T, 0, 1/2 A ML(q1\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) MR(q2 r0\texorpdfstring{$^\wedge$}{\string^}\texorpdfstring{$\ast$}{*}) A\texorpdfstring{$^\wedge$}{\string^}T\mbox{]} = \mbox{[}0, -\/JP, 0, JP\mbox{]}

Suggested reading\+:
\begin{DoxyItemize}
\item 3D \doxylink{classConstraint}{Constraint} Derivations for Impulse Solvers -\/ Marijn Tamis
\item Game Physics Pearls -\/ Section 9 -\/ Quaternion Based Constraints -\/ Claude Lacoursiere 
\end{DoxyItemize}

The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
includes/jolt/\+Physics/\+Constraints/\+Constraint\+Part/Rotation\+Quat\+Constraint\+Part.\+h\end{DoxyCompactItemize}
