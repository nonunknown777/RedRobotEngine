\doxysection{Active\+Edges.\+h}
\hypertarget{ActiveEdges_8h_source}{}\label{ActiveEdges_8h_source}\index{includes/jolt/Physics/Collision/ActiveEdges.h@{includes/jolt/Physics/Collision/ActiveEdges.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Jolt\ Physics\ Library\ (https://github.com/jrouwe/JoltPhysics)}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ SPDX-\/FileCopyrightText:\ 2021\ Jorrit\ Rouwe}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ SPDX-\/License-\/Identifier:\ MIT}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <Jolt/Geometry/ClosestPoint.h>}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ JPH\_NAMESPACE\_BEGIN}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceActiveEdges}{ActiveEdges}}}
\DoxyCodeLine{00013\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IsEdgeActive(\mbox{\hyperlink{classVec3}{Vec3Arg}}\ inNormal1,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inNormal2,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inEdgeDirection,\ \textcolor{keywordtype}{float}\ inCosThresholdAngle)}
\DoxyCodeLine{00020\ \ \ \ \ \{}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ normals\ are\ opposite\ the\ edges\ are\ active\ (the\ triangles\ are\ back\ to\ back)}}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ cos\_angle\_normals\ =\ inNormal1.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(inNormal2);}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cos\_angle\_normals\ <\ -\/0.999848f)\ \textcolor{comment}{//\ cos(179\ degrees)}}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ concave\ edge,\ if\ so\ we\ are\ not\ active}}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inNormal1.\mbox{\hyperlink{classVec3_a224811af391ccfd1e05282eda22d1de8}{Cross}}(inNormal2).\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(inEdgeDirection)\ <\ 0.0f)}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convex\ edge,\ active\ when\ angle\ bigger\ than\ threshold}}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cos\_angle\_normals\ <\ inCosThresholdAngle;}
\DoxyCodeLine{00032\ \ \ \ \ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{classVec3}{Vec3}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FixNormal(\mbox{\hyperlink{classVec3}{Vec3Arg}}\ inV0,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inV1,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inV2,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inTriangleNormal,\ uint8\ inActiveEdges,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inPoint,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inNormal,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inMovementDirection)}
\DoxyCodeLine{00043\ \ \ \ \ \{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check:\ All\ of\ the\ edges\ are\ active,\ we\ have\ the\ correct\ normal\ already.\ No\ need\ to\ call\ this\ function!}}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ JPH\_ASSERT(inActiveEdges\ !=\ 0b111);}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ inNormal\ would\ affect\ movement\ less\ than\ inTriangleNormal\ use\ inNormal}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ done\ since\ it\ is\ really\ hard\ to\ make\ a\ distinction\ between\ sliding\ over\ a\ horizontal\ triangulated\ grid\ and\ hitting\ an\ edge\ (in\ this\ case\ you\ want\ to\ use\ the\ triangle\ normal)}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ sliding\ over\ a\ triangulated\ grid\ and\ grazing\ a\ vertical\ triangle\ with\ an\ inactive\ edge\ (in\ this\ case\ using\ the\ triangle\ normal\ will\ cause\ the\ object\ to\ bounce\ back\ so\ we\ want\ to\ use\ the\ calculated\ normal).}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ solve\ this\ we\ take\ a\ movement\ hint\ to\ give\ an\ indication\ of\ what\ direction\ our\ object\ is\ moving.\ If\ the\ edge\ normal\ results\ in\ less\ motion\ difference\ than\ the\ triangle\ normal\ we\ use\ the\ edge\ normal.}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ normal\_length\ =\ inNormal.\mbox{\hyperlink{classVec3_a38a9efffc3f9413f3dd702abc73eb9a2}{Length}}();}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ triangle\_normal\_length\ =\ inTriangleNormal.\mbox{\hyperlink{classVec3_a38a9efffc3f9413f3dd702abc73eb9a2}{Length}}();}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inMovementDirection.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(inNormal)\ *\ triangle\_normal\_length\ <\ inMovementDirection.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(inTriangleNormal)\ *\ normal\_length)}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ inNormal;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check:\ None\ of\ the\ edges\ are\ active,\ we\ need\ to\ use\ the\ triangle\ normal}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inActiveEdges\ ==\ 0)}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ inTriangleNormal;}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Some\ edges\ are\ active.}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ normal\ is\ parallel\ to\ the\ triangle\ normal\ we\ don't\ need\ to\ check\ the\ active\ edges.}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inTriangleNormal.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(inNormal)\ >\ 0.999848f\ *\ normal\_length\ *\ triangle\_normal\_length)\ \textcolor{comment}{//\ cos(1\ degree)}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ inNormal;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ cEpsilon\ =\ 1.0e-\/4f;}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ cOneMinusEpsilon\ =\ 1.0f\ -\/\ cEpsilon;}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ uint\ colliding\_edge;}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ where\ the\ contact\ point\ is\ in\ the\ triangle}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ u,\ v,\ w;}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceClosestPoint_a292e497d840ac56d4004212fd10b18e4}{ClosestPoint::GetBaryCentricCoordinates}}(inV0\ -\/\ inPoint,\ inV1\ -\/\ inPoint,\ inV2\ -\/\ inPoint,\ u,\ v,\ w);}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (u\ >\ cOneMinusEpsilon)}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Colliding\ with\ v0,\ edge\ 0\ or\ 2\ needs\ to\ be\ active}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ colliding\_edge\ =\ 0b101;}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (v\ >\ cOneMinusEpsilon)}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Colliding\ with\ v1,\ edge\ 0\ or\ 1\ needs\ to\ be\ active}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ colliding\_edge\ =\ 0b011;}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (w\ >\ cOneMinusEpsilon)}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Colliding\ with\ v2,\ edge\ 1\ or\ 2\ needs\ to\ be\ active}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ colliding\_edge\ =\ 0b110;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (u\ <\ cEpsilon)}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Colliding\ with\ edge\ v1,\ v2,\ edge\ 1\ needs\ to\ be\ active}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ colliding\_edge\ =\ 0b010;}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (v\ <\ cEpsilon)}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Colliding\ with\ edge\ v0,\ v2,\ edge\ 2\ needs\ to\ be\ active}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ colliding\_edge\ =\ 0b100;}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (w\ <\ cEpsilon)}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Colliding\ with\ edge\ v0,\ v1,\ edge\ 0\ needs\ to\ be\ active}}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ colliding\_edge\ =\ 0b001;}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Interior\ hit}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ inTriangleNormal;}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ this\ edge\ is\ active,\ use\ the\ provided\ normal\ instead\ of\ the\ triangle\ normal}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (inActiveEdges\ \&\ colliding\_edge)\ !=\ 0?\ inNormal\ :\ inTriangleNormal;}
\DoxyCodeLine{00111\ \ \ \ \ \}}
\DoxyCodeLine{00112\ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ JPH\_NAMESPACE\_END}

\end{DoxyCode}
