\doxysection{Ray\+Cylinder.\+h}
\hypertarget{RayCylinder_8h_source}{}\label{RayCylinder_8h_source}\index{includes/jolt/Geometry/RayCylinder.h@{includes/jolt/Geometry/RayCylinder.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Jolt\ Physics\ Library\ (https://github.com/jrouwe/JoltPhysics)}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ SPDX-\/FileCopyrightText:\ 2021\ Jorrit\ Rouwe}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ SPDX-\/License-\/Identifier:\ MIT}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <Jolt/Math/FindRoot.h>}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ JPH\_NAMESPACE\_BEGIN}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00017\ JPH\_INLINE\ \textcolor{keywordtype}{float}\ RayCylinder(\mbox{\hyperlink{classVec3}{Vec3Arg}}\ inRayOrigin,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inRayDirection,\ \textcolor{keywordtype}{float}\ inCylinderRadius)}
\DoxyCodeLine{00018\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{comment}{//\ Remove\ Y\ component\ of\ ray\ to\ see\ of\ ray\ intersects\ with\ infinite\ cylinder}}
\DoxyCodeLine{00020\ \ \ \ \ \mbox{\hyperlink{classUVec4}{UVec4}}\ mask\_y\ =\ \mbox{\hyperlink{classUVec4}{UVec4}}(0,\ 0xffffffff,\ 0,\ 0);}
\DoxyCodeLine{00021\ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ origin\_xz\ =\ \mbox{\hyperlink{classVec3_a9f893b7c7bc6ef51c19ceeb3c195dd22}{Vec3::sSelect}}(inRayOrigin,\ \mbox{\hyperlink{classVec3_ad03c52ab27761bc1e64e33c47632ba51}{Vec3::sZero}}(),\ mask\_y);}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordtype}{float}\ origin\_xz\_len\_sq\ =\ origin\_xz.\mbox{\hyperlink{classVec3_aba501a6a474028084799f871c9083dc1}{LengthSq}}();}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordtype}{float}\ r\_sq\ =\ Square(inCylinderRadius);}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordflow}{if}\ (origin\_xz\_len\_sq\ >\ r\_sq)}
\DoxyCodeLine{00025\ \ \ \ \ \{}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ray\ starts\ outside\ of\ the\ infinite\ cylinder}}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Solve:\ |RayOrigin\_xz\ +\ fraction\ *\ RayDirection\_xz|\string^2\ =\ r\string^2\ to\ find\ fraction}}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ direction\_xz\ =\ \mbox{\hyperlink{classVec3_a9f893b7c7bc6ef51c19ceeb3c195dd22}{Vec3::sSelect}}(inRayDirection,\ \mbox{\hyperlink{classVec3_ad03c52ab27761bc1e64e33c47632ba51}{Vec3::sZero}}(),\ mask\_y);}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ a\ =\ direction\_xz.\mbox{\hyperlink{classVec3_aba501a6a474028084799f871c9083dc1}{LengthSq}}();}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ b\ =\ 2.0f\ *\ origin\_xz.\mbox{\hyperlink{classVec3_a0e078ff09f69e669db71a2b0e37939ff}{Dot}}(direction\_xz);}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ c\ =\ origin\_xz\_len\_sq\ -\/\ r\_sq;}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ fraction1,\ fraction2;}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FindRoot(a,\ b,\ c,\ fraction1,\ fraction2)\ ==\ 0)}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ FLT\_MAX;\ \textcolor{comment}{//\ No\ intersection\ with\ infinite\ cylinder}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ fraction\ corresponding\ to\ the\ ray\ entering\ the\ circle}}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ fraction\ =\ min(fraction1,\ fraction2);}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fraction\ >=\ 0.0f)}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ fraction;}
\DoxyCodeLine{00040\ \ \ \ \ \}}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00042\ \ \ \ \ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ray\ starts\ inside\ the\ infinite\ cylinder}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0f;}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{comment}{//\ No\ collision}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{return}\ FLT\_MAX;}
\DoxyCodeLine{00049\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00057\ JPH\_INLINE\ \textcolor{keywordtype}{float}\ RayCylinder(\mbox{\hyperlink{classVec3}{Vec3Arg}}\ inRayOrigin,\ \mbox{\hyperlink{classVec3}{Vec3Arg}}\ inRayDirection,\ \textcolor{keywordtype}{float}\ inCylinderHalfHeight,\ \textcolor{keywordtype}{float}\ inCylinderRadius)}
\DoxyCodeLine{00058\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ Test\ infinite\ cylinder}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{float}\ fraction\ =\ RayCylinder(inRayOrigin,\ inRayDirection,\ inCylinderRadius);}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordflow}{if}\ (fraction\ ==\ FLT\_MAX)}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ FLT\_MAX;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{//\ If\ this\ hit\ is\ in\ the\ finite\ cylinder\ we\ have\ our\ fraction}}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{group__FixedMath_ga403b0629c377f62b89a74cb4a39d0ce2}{abs}}(inRayOrigin.GetY()\ +\ fraction\ *\ inRayDirection.GetY())\ <=\ inCylinderHalfHeight)}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ fraction;}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ ray\ could\ hit\ the\ top\ or\ bottom\ plane\ of\ the\ cylinder}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{float}\ direction\_y\ =\ inRayDirection.GetY();}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordflow}{if}\ (direction\_y\ !=\ 0.0f)}
\DoxyCodeLine{00071\ \ \ \ \ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Solving\ line\ equation:\ x\ =\ ray\_origin\ +\ fraction\ *\ ray\_direction}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ plane\ equation:\ plane\_normal\ .\ x\ +\ plane\_constant\ =\ 0}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ fraction\ =\ (-\/plane\_constant\ -\/\ plane\_normal\ .\ ray\_origin)\ /\ (plane\_normal\ .\ ray\_direction)}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ when\ the\ ray\_direction.y\ <\ 0:}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ plane\_constant\ =\ -\/cylinder\_half\_height,\ plane\_normal\ =\ (0,\ 1,\ 0)}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ else}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ plane\_constant\ =\ -\/cylinder\_half\_height,\ plane\_normal\ =\ (0,\ -\/1,\ 0)}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ origin\_y\ =\ inRayOrigin.GetY();}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ plane\_fraction;}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (direction\_y\ <\ 0.0f)}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ plane\_fraction\ =\ (inCylinderHalfHeight\ -\/\ origin\_y)\ /\ direction\_y;}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ plane\_fraction\ =\ -\/(inCylinderHalfHeight\ +\ origin\_y)\ /\ direction\_y;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ hit\ is\ in\ front\ of\ the\ ray}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (plane\_fraction\ >=\ 0.0f)}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ if\ this\ hit\ is\ inside\ the\ cylinder}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVec3}{Vec3}}\ point\ =\ inRayOrigin\ +\ plane\_fraction\ *\ inRayDirection;}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ dist\_sq\ =\ Square(point.\mbox{\hyperlink{classVec3_a284e29f161ae7709a934f402bd2a848c}{GetX}}())\ +\ Square(point.GetZ());}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist\_sq\ <=\ Square(inCylinderRadius))}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ plane\_fraction;}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ No\ collision}}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{return}\ FLT\_MAX;}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ JPH\_NAMESPACE\_END}

\end{DoxyCode}
