\doxysection{Job\+System Class Reference}
\hypertarget{classJobSystem}{}\label{classJobSystem}\index{JobSystem@{JobSystem}}


{\ttfamily \#include $<$Job\+System.\+h$>$}



Inheritance diagram for Job\+System\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{d1/d52/classJobSystem__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for Job\+System\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=206pt]{de/d57/classJobSystem__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classJobSystem_1_1Barrier}{Barrier}}
\begin{DoxyCompactList}\small\item\em A job barrier keeps track of a number of jobs and allows waiting until they are all completed. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classJobSystem_1_1Job}{Job}}
\begin{DoxyCompactList}\small\item\em A class that contains information for a single unit of work. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classJobSystem_1_1JobHandle}{Job\+Handle}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classJobSystem_ae31ef61a509934f03d4705aec19c61f5}\label{classJobSystem_ae31ef61a509934f03d4705aec19c61f5} 
using {\bfseries Job\+Function} = function$<$ void()$>$
\begin{DoxyCompactList}\small\item\em Main function of the job. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classJobSystem_aaaf28c0a93f2d52eb2c936807f9e8ec9}\label{classJobSystem_aaaf28c0a93f2d52eb2c936807f9e8ec9} 
virtual {\bfseries \texorpdfstring{$\sim$}{\string~}\+Job\+System} ()=default
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
virtual int \mbox{\hyperlink{classJobSystem_a5953ad34be5c47e7896b87ac7409b7d7}{Get\+Max\+Concurrency}} () const =0
\begin{DoxyCompactList}\small\item\em Get maximum number of concurrently executing jobs. \end{DoxyCompactList}\item 
virtual \mbox{\hyperlink{classJobSystem_1_1JobHandle}{Job\+Handle}} \mbox{\hyperlink{classJobSystem_a0766c8acd5ed9ef0e6baf1c2b8f3c38b}{Create\+Job}} (const char \texorpdfstring{$\ast$}{*}in\+Name, \mbox{\hyperlink{classColor}{Color\+Arg}} in\+Color, const \mbox{\hyperlink{classJobSystem_ae31ef61a509934f03d4705aec19c61f5}{Job\+Function}} \&in\+Job\+Function, uint32 in\+Num\+Dependencies=0)=0
\item 
virtual \mbox{\hyperlink{classJobSystem_1_1Barrier}{Barrier}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{classJobSystem_a2bd7c3efdc8f934b728ee1787e0bd58e}{Create\+Barrier}} ()=0
\begin{DoxyCompactList}\small\item\em Create a new barrier, used to wait on jobs. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classJobSystem_a51c615924cf4f8eefb8e3fbe72041373}{Destroy\+Barrier}} (\mbox{\hyperlink{classJobSystem_1_1Barrier}{Barrier}} \texorpdfstring{$\ast$}{*}in\+Barrier)=0
\begin{DoxyCompactList}\small\item\em Destroy a barrier when it is no longer used. The barrier should be empty at this point. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classJobSystem_a32e93cf0a95e8893978cf1ee92eb41d7}{Wait\+For\+Jobs}} (\mbox{\hyperlink{classJobSystem_1_1Barrier}{Barrier}} \texorpdfstring{$\ast$}{*}in\+Barrier)=0
\begin{DoxyCompactList}\small\item\em Wait for a set of jobs to be finished, note that only 1 thread can be waiting on a barrier at a time. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classNonCopyable}{Non\+Copyable}}}
\begin{DoxyCompactItemize}
\item 
{\bfseries Non\+Copyable} (const \mbox{\hyperlink{classNonCopyable}{Non\+Copyable}} \&)=delete
\item 
void {\bfseries operator=} (const \mbox{\hyperlink{classNonCopyable}{Non\+Copyable}} \&)=delete
\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
virtual void \mbox{\hyperlink{classJobSystem_ae6bae9c5725c2009c8e9a2d79f60cb40}{Queue\+Job}} (\mbox{\hyperlink{classJobSystem_1_1Job}{Job}} \texorpdfstring{$\ast$}{*}in\+Job)=0
\begin{DoxyCompactList}\small\item\em Adds a job to the job queue. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classJobSystem_a5820eef46d040e6ae17e51a828201118}{Queue\+Jobs}} (\mbox{\hyperlink{classJobSystem_1_1Job}{Job}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}in\+Jobs, uint in\+Num\+Jobs)=0
\begin{DoxyCompactList}\small\item\em Adds a number of jobs at once to the job queue. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classJobSystem_aa74329d956a01e3f2f219ea22bdc5097}{Free\+Job}} (\mbox{\hyperlink{classJobSystem_1_1Job}{Job}} \texorpdfstring{$\ast$}{*}in\+Job)=0
\begin{DoxyCompactList}\small\item\em Frees a job. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
A class that allows units of work (Jobs) to be scheduled across multiple threads. It allows dependencies between the jobs so that the jobs form a graph.

The pattern for using this class is\+: \begin{DoxyVerb}// Create job system
JobSystem *job_system = new JobSystemThreadPool(...);

// Create some jobs
JobHandle second_job = job_system->CreateJob("SecondJob", Color::sRed, []() { ... }, 1); // Create a job with 1 dependency
JobHandle first_job = job_system->CreateJob("FirstJob", Color::sGreen, [second_job]() { ....; second_job.RemoveDependency(); }, 0); // Job can start immediately, will start second job when it's done
JobHandle third_job = job_system->CreateJob("ThirdJob", Color::sBlue, []() { ... }, 0); // This job can run immediately as well and can run in parallel to job 1 and 2

// Add the jobs to the barrier so that we can execute them while we're waiting
Barrier *barrier = job_system->CreateBarrier();
barrier->AddJob(first_job);
barrier->AddJob(second_job);
barrier->AddJob(third_job);
job_system->WaitForJobs(barrier);

// Clean up
job_system->DestroyBarrier(barrier);
delete job_system;
\end{DoxyVerb}
 Jobs are guaranteed to be started in the order that their dependency counter becomes zero (in case they\textquotesingle{}re scheduled on a background thread) or in the order they\textquotesingle{}re added to the barrier (when dependency count is zero and when executing on the thread that calls Wait\+For\+Jobs).

If you want to implement your own job system, inherit from \doxylink{classJobSystem}{Job\+System} and implement\+:


\begin{DoxyItemize}
\item \doxylink{classJobSystem_a5953ad34be5c47e7896b87ac7409b7d7}{Job\+System\+::\+Get\+Max\+Concurrency} -\/ This should return the maximum number of jobs that can run in parallel.
\item \doxylink{classJobSystem_a0766c8acd5ed9ef0e6baf1c2b8f3c38b}{Job\+System\+::\+Create\+Job} -\/ This should create a \doxylink{classJobSystem_1_1Job}{Job} object and return it to the caller.
\item \doxylink{classJobSystem_aa74329d956a01e3f2f219ea22bdc5097}{Job\+System\+::\+Free\+Job} -\/ This should free the memory associated with the job object. It is called by the \doxylink{classJobSystem_1_1Job}{Job} destructor when it is Release()-\/ed for the last time.
\item \doxylink{classJobSystem_ae6bae9c5725c2009c8e9a2d79f60cb40}{Job\+System\+::\+Queue\+Job}/\+Queue\+Jobs -\/ These should store the job pointer in an internal queue to run immediately (dependencies are tracked internally, this function is called when the job can run). The \doxylink{classJobSystem_1_1Job}{Job} objects are reference counted and are guaranteed to stay alive during the Queue\+Job(s) call. If you store the job in your own data structure you need to call Add\+Ref() to take a reference. After the job has been executed you need to call Release() to release the reference. Make sure you no longer dereference the job pointer after calling Release().
\end{DoxyItemize}

\doxylink{classJobSystem_1_1Barrier}{Job\+System\+::\+Barrier} is used to track the completion of a set of jobs. Jobs will be created by other jobs and added to the barrier while it is being waited on. This means that you cannot create a dependency graph beforehand as the graph changes while jobs are running. Implement the following functions\+:


\begin{DoxyItemize}
\item \doxylink{classJobSystem_1_1Barrier_afcf8f345a7a19e1399c4899942ed49c4}{Barrier\+::\+Add\+Job}/\+Add\+Jobs -\/ Add a job to the barrier, any call to Wait\+For\+Jobs will now also wait for this job to complete. If you store the job in a data structure in the \doxylink{classJobSystem_1_1Barrier}{Barrier} you need to call Add\+Ref() on the job to keep it alive and Release() after you\textquotesingle{}re done with it.
\item \doxylink{classJobSystem_1_1Barrier_ab76635eef3bb293a2bceb429192adb2a}{Barrier\+::\+On\+Job\+Finished} -\/ This function is called when a job has finished executing, you can use this to track completion and remove the job from the list of jobs to wait on.
\end{DoxyItemize}

The functions on \doxylink{classJobSystem}{Job\+System} that need to be implemented to support barriers are\+:


\begin{DoxyItemize}
\item \doxylink{classJobSystem_a2bd7c3efdc8f934b728ee1787e0bd58e}{Job\+System\+::\+Create\+Barrier} -\/ Create a new barrier.
\item \doxylink{classJobSystem_a51c615924cf4f8eefb8e3fbe72041373}{Job\+System\+::\+Destroy\+Barrier} -\/ Destroy a barrier.
\item \doxylink{classJobSystem_a32e93cf0a95e8893978cf1ee92eb41d7}{Job\+System\+::\+Wait\+For\+Jobs} -\/ This is the main function that is used to wait for all jobs that have been added to a \doxylink{classJobSystem_1_1Barrier}{Barrier}. Wait\+For\+Jobs can execute jobs that have been added to the barrier while waiting. It is not wise to execute other jobs that touch physics structures as this can cause race conditions and deadlocks. Please keep in mind that the barrier is only intended to wait on the completion of the Jolt jobs added to it, if you scheduled any jobs in your engine\textquotesingle{}s job system to execute the Jolt jobs as part of Queue\+Job/\+Queue\+Jobs, you might still need to wait for these in this function after the barrier is finished waiting.
\end{DoxyItemize}

An example implementation is \doxylink{classJobSystemThreadPool}{Job\+System\+Thread\+Pool}. If you don\textquotesingle{}t want to write the \doxylink{classJobSystem_1_1Barrier}{Barrier} class you can also inherit from \doxylink{classJobSystemWithBarrier}{Job\+System\+With\+Barrier}. 

\doxysubsection{Member Function Documentation}
\Hypertarget{classJobSystem_a2bd7c3efdc8f934b728ee1787e0bd58e}\label{classJobSystem_a2bd7c3efdc8f934b728ee1787e0bd58e} 
\index{JobSystem@{JobSystem}!CreateBarrier@{CreateBarrier}}
\index{CreateBarrier@{CreateBarrier}!JobSystem@{JobSystem}}
\doxysubsubsection{\texorpdfstring{CreateBarrier()}{CreateBarrier()}}
{\footnotesize\ttfamily virtual \mbox{\hyperlink{classJobSystem_1_1Barrier}{Barrier}} \texorpdfstring{$\ast$}{*} Job\+System\+::\+Create\+Barrier (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}



Create a new barrier, used to wait on jobs. 



Implemented in \mbox{\hyperlink{classJobSystemSingleThreaded_ab139f52a2294cae049a0cc5fe6f96c1d}{Job\+System\+Single\+Threaded}}, and \mbox{\hyperlink{classJobSystemWithBarrier_aca991a2fb322f5d76a5ab8bd1056eba4}{Job\+System\+With\+Barrier}}.

\Hypertarget{classJobSystem_a0766c8acd5ed9ef0e6baf1c2b8f3c38b}\label{classJobSystem_a0766c8acd5ed9ef0e6baf1c2b8f3c38b} 
\index{JobSystem@{JobSystem}!CreateJob@{CreateJob}}
\index{CreateJob@{CreateJob}!JobSystem@{JobSystem}}
\doxysubsubsection{\texorpdfstring{CreateJob()}{CreateJob()}}
{\footnotesize\ttfamily virtual \mbox{\hyperlink{classJobSystem_1_1JobHandle}{Job\+Handle}} Job\+System\+::\+Create\+Job (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{in\+Name,  }\item[{\mbox{\hyperlink{classColor}{Color\+Arg}}}]{in\+Color,  }\item[{const \mbox{\hyperlink{classJobSystem_ae31ef61a509934f03d4705aec19c61f5}{Job\+Function}} \&}]{in\+Job\+Function,  }\item[{uint32}]{in\+Num\+Dependencies = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}

Create a new job, the job is started immediately if in\+Num\+Dependencies == 0 otherwise it starts when Remove\+Dependency causes the dependency counter to reach 0. 

Implemented in \mbox{\hyperlink{classJobSystemSingleThreaded_aeb1a658b232b51fc2b85ad330d635114}{Job\+System\+Single\+Threaded}}, and \mbox{\hyperlink{classJobSystemThreadPool_aaca24192ded59a7ade7e655a495f9d48}{Job\+System\+Thread\+Pool}}.

\Hypertarget{classJobSystem_a51c615924cf4f8eefb8e3fbe72041373}\label{classJobSystem_a51c615924cf4f8eefb8e3fbe72041373} 
\index{JobSystem@{JobSystem}!DestroyBarrier@{DestroyBarrier}}
\index{DestroyBarrier@{DestroyBarrier}!JobSystem@{JobSystem}}
\doxysubsubsection{\texorpdfstring{DestroyBarrier()}{DestroyBarrier()}}
{\footnotesize\ttfamily virtual void Job\+System\+::\+Destroy\+Barrier (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classJobSystem_1_1Barrier}{Barrier}} \texorpdfstring{$\ast$}{*}}]{in\+Barrier }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}



Destroy a barrier when it is no longer used. The barrier should be empty at this point. 



Implemented in \mbox{\hyperlink{classJobSystemSingleThreaded_a19d614f2623e9ba92e2595ce0a8f5ca4}{Job\+System\+Single\+Threaded}}, and \mbox{\hyperlink{classJobSystemWithBarrier_ac79c4e42c23342f1ce2efe4abdc4303f}{Job\+System\+With\+Barrier}}.

\Hypertarget{classJobSystem_aa74329d956a01e3f2f219ea22bdc5097}\label{classJobSystem_aa74329d956a01e3f2f219ea22bdc5097} 
\index{JobSystem@{JobSystem}!FreeJob@{FreeJob}}
\index{FreeJob@{FreeJob}!JobSystem@{JobSystem}}
\doxysubsubsection{\texorpdfstring{FreeJob()}{FreeJob()}}
{\footnotesize\ttfamily virtual void Job\+System\+::\+Free\+Job (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classJobSystem_1_1Job}{Job}} \texorpdfstring{$\ast$}{*}}]{in\+Job }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [pure virtual]}}



Frees a job. 



Implemented in \mbox{\hyperlink{classJobSystemSingleThreaded_a6b8299d377697a5d2c76fd94f9c34d68}{Job\+System\+Single\+Threaded}}, and \mbox{\hyperlink{classJobSystemThreadPool_ad9ae9ac8231c2098b99837b76e4155f9}{Job\+System\+Thread\+Pool}}.

\Hypertarget{classJobSystem_a5953ad34be5c47e7896b87ac7409b7d7}\label{classJobSystem_a5953ad34be5c47e7896b87ac7409b7d7} 
\index{JobSystem@{JobSystem}!GetMaxConcurrency@{GetMaxConcurrency}}
\index{GetMaxConcurrency@{GetMaxConcurrency}!JobSystem@{JobSystem}}
\doxysubsubsection{\texorpdfstring{GetMaxConcurrency()}{GetMaxConcurrency()}}
{\footnotesize\ttfamily virtual int Job\+System\+::\+Get\+Max\+Concurrency (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [pure virtual]}}



Get maximum number of concurrently executing jobs. 



Implemented in \mbox{\hyperlink{classJobSystemSingleThreaded_a4e99aebfb2308cf3c4bdd8e54bb71799}{Job\+System\+Single\+Threaded}}, and \mbox{\hyperlink{classJobSystemThreadPool_ad9d1ead2ffc5ab1ec9aa6e06948c98ac}{Job\+System\+Thread\+Pool}}.

\Hypertarget{classJobSystem_ae6bae9c5725c2009c8e9a2d79f60cb40}\label{classJobSystem_ae6bae9c5725c2009c8e9a2d79f60cb40} 
\index{JobSystem@{JobSystem}!QueueJob@{QueueJob}}
\index{QueueJob@{QueueJob}!JobSystem@{JobSystem}}
\doxysubsubsection{\texorpdfstring{QueueJob()}{QueueJob()}}
{\footnotesize\ttfamily virtual void Job\+System\+::\+Queue\+Job (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classJobSystem_1_1Job}{Job}} \texorpdfstring{$\ast$}{*}}]{in\+Job }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [pure virtual]}}



Adds a job to the job queue. 



Implemented in \mbox{\hyperlink{classJobSystemSingleThreaded_a1dfe9fbc605a326ae45b93ba9a65f3e4}{Job\+System\+Single\+Threaded}}, and \mbox{\hyperlink{classJobSystemThreadPool_ae5a196fc16e3dd738c81eef74b3027c4}{Job\+System\+Thread\+Pool}}.

\Hypertarget{classJobSystem_a5820eef46d040e6ae17e51a828201118}\label{classJobSystem_a5820eef46d040e6ae17e51a828201118} 
\index{JobSystem@{JobSystem}!QueueJobs@{QueueJobs}}
\index{QueueJobs@{QueueJobs}!JobSystem@{JobSystem}}
\doxysubsubsection{\texorpdfstring{QueueJobs()}{QueueJobs()}}
{\footnotesize\ttfamily virtual void Job\+System\+::\+Queue\+Jobs (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classJobSystem_1_1Job}{Job}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{in\+Jobs,  }\item[{uint}]{in\+Num\+Jobs }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [pure virtual]}}



Adds a number of jobs at once to the job queue. 



Implemented in \mbox{\hyperlink{classJobSystemSingleThreaded_a3db6fa8af3ffc7f644c8c1a4ce79bfac}{Job\+System\+Single\+Threaded}}, and \mbox{\hyperlink{classJobSystemThreadPool_a95cc3e8610b53bce87730404f44c7e96}{Job\+System\+Thread\+Pool}}.

\Hypertarget{classJobSystem_a32e93cf0a95e8893978cf1ee92eb41d7}\label{classJobSystem_a32e93cf0a95e8893978cf1ee92eb41d7} 
\index{JobSystem@{JobSystem}!WaitForJobs@{WaitForJobs}}
\index{WaitForJobs@{WaitForJobs}!JobSystem@{JobSystem}}
\doxysubsubsection{\texorpdfstring{WaitForJobs()}{WaitForJobs()}}
{\footnotesize\ttfamily virtual void Job\+System\+::\+Wait\+For\+Jobs (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classJobSystem_1_1Barrier}{Barrier}} \texorpdfstring{$\ast$}{*}}]{in\+Barrier }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}



Wait for a set of jobs to be finished, note that only 1 thread can be waiting on a barrier at a time. 



Implemented in \mbox{\hyperlink{classJobSystemSingleThreaded_a6647ac6cbc0d3c57ba788fe38eaab591}{Job\+System\+Single\+Threaded}}, and \mbox{\hyperlink{classJobSystemWithBarrier_a6a23958171f0eb1f0ccfc080cfe95256}{Job\+System\+With\+Barrier}}.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
includes/jolt/\+Core/Job\+System.\+h\end{DoxyCompactItemize}
